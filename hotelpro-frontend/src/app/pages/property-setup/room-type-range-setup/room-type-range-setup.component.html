<div class="container container_form my-3 rounded">
  <form [formGroup]="roomTypeForm">
    <div class="row row-cols-1 row-cols-md-2">
      <div class="col mt-3">
        <label class="form-label">Room Type Name*</label>
        <input
          type="text"
          class="form-control"
          formControlName="roomTypeName"
          placeholder="Enter Room Type Name"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('roomTypeName')?.dirty ||
                roomTypeForm.get('roomTypeName')?.touched) &&
              roomTypeForm.get('roomTypeName')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('roomTypeName')?.dirty ||
              roomTypeForm.get('roomTypeName')?.touched) &&
            roomTypeForm.get('roomTypeName')?.invalid
          "
          >Room Type Name is required</small
        >
      </div>

      <!-- <div class="col mt-3">
        <label class="form-label">Room Type Category</label>
        <input
          type="text"
          class="form-control"
          formControlName="roomTypeCategory"
          placeholder="Enter Room Type Category"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('roomTypeCategory')?.dirty ||
                roomTypeForm.get('roomTypeCategory')?.touched) &&
              roomTypeForm.get('roomTypeCategory')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('roomTypeCategory')?.dirty ||
              roomTypeForm.get('roomTypeCategory')?.touched) &&
            roomTypeForm.get('roomTypeCategory')?.invalid
          "
          >Room Type Category is required</small
        >
      </div> -->

      <div class="col mt-3">
        <label class="form-label">Description</label>
        <input
          type="text"
          class="form-control"
          formControlName="description"
          placeholder="Enter Description"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('description')?.dirty ||
                roomTypeForm.get('description')?.touched) &&
              roomTypeForm.get('description')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('description')?.dirty ||
              roomTypeForm.get('description')?.touched) &&
            roomTypeForm.get('description')?.invalid
          "
          >Description is required</small
        >
      </div>

      <div class="col mt-3">
        <label class="form-label">Adult Occupancy*</label>
        <input
          type="number"
          class="form-control"
          formControlName="adultOccupancy"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('adultOccupancy')?.dirty ||
                roomTypeForm.get('adultOccupancy')?.touched) &&
              roomTypeForm.get('adultOccupancy')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('adultOccupancy')?.dirty ||
              roomTypeForm.get('adultOccupancy')?.touched) &&
            roomTypeForm.get('adultOccupancy')?.invalid
          "
          >Adult Occupancy is required</small
        >
      </div>

      <div class="col mt-3">
        <label class="form-label">Child Occupancy</label>
        <input
          type="number"
          class="form-control"
          formControlName="childOccupancy"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('childOccupancy')?.dirty ||
                roomTypeForm.get('childOccupancy')?.touched) &&
              roomTypeForm.get('childOccupancy')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('childOccupancy')?.dirty ||
              roomTypeForm.get('childOccupancy')?.touched) &&
            roomTypeForm.get('childOccupancy')?.invalid
          "
          >Child Occupancy is required</small
        >
      </div>
      <div class="col mt-3" *ngIf="roomTypeId == 'ADD'">
        <label class="form-label">Default Room Rate</label>
        <input
          type="number"
          class="form-control"
          formControlName="baseRate"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('baseRate')?.dirty ||
                roomTypeForm.get('baseRate')?.touched) &&
              roomTypeForm.get('baseRate')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('baseRate')?.dirty ||
              roomTypeForm.get('baseRate')?.touched) &&
            roomTypeForm.get('baseRate')?.invalid
          "
          >Rate is required</small
        >
      </div>
      <div class="col mt-3 ms-3 form-check" *ngIf="roomTypeId != 'ADD'">
        <input
          type="checkbox"
          class="form-check-input"
          formControlName="active"
        />
        <label class="form-check-label">Active</label>
      </div>
      <div class="col mt-3" *ngIf="roomTypeId == 'ADD'">
        <label class="form-label">Total Rooms</label>
        <input
          type="number"
          class="form-control"
          formControlName="totalrooms"
          [ngClass]="{
            'is-invalid':
              (roomTypeForm.get('totalrooms')?.dirty ||
                roomTypeForm.get('totalrooms')?.touched) &&
              roomTypeForm.get('totalrooms')?.invalid
          }"
        />
        <small
          class="text-danger"
          *ngIf="
            (roomTypeForm.get('totalrooms')?.dirty ||
              roomTypeForm.get('totalrooms')?.touched) &&
            roomTypeForm.get('totalrooms')?.invalid
          "
          >Total Rooms is required</small
        >
      </div>
    </div>
    <div *ngIf="roomTypeForm.errors?.totalRoomsMismatch">
      <p class="text-danger mt-2"> Click below button to fill room details. </p>
    </div>
    <div *ngIf="roomTypeForm.errors?.overlappingRanges">
      <p class="text-danger mt-2"> There are overlapping room ranges. </p>
    </div>

    <div
      formArrayName="rooms"
      class="mt-4 border-top"
      *ngFor="let room of rooms.controls; let i = index"
    >
      <div [formGroupName]="i" class="row mt-3">
        <div class="col-md-2 mt-2">
          <label class="form-label">Prefix</label>
          <input
            type="text"
            formControlName="prefix"
            class="form-control"
            placeholder="Prefix"
          />
        </div>
        <div class="col-md-2 mt-2">
          <label class="form-label">Start</label>
          <input
            type="number"
            formControlName="start"
            class="form-control"
            placeholder="Start"
            [ngClass]="{
              'is-invalid':
                (room.get('start')?.dirty || room.get('start')?.touched) &&
                room.get('start')?.invalid
            }"
          />
          <small
            class="text-danger"
            *ngIf="
              (room.get('start')?.dirty || room.get('start')?.touched) &&
              room.get('start')?.invalid
            "
            >Start is required</small
          >
        </div>
        <div class="col-md-2 mt-2">
          <label class="form-label">End</label>
          <input
            type="number"
            formControlName="end"
            class="form-control"
            placeholder="End"
            [ngClass]="{
              'is-invalid':
                (room.get('end')?.dirty || room.get('end')?.touched) &&
                room.get('end')?.invalid
            }"
          />
          <small
            class="text-danger"
            *ngIf="
              (room.get('end')?.dirty || room.get('end')?.touched) &&
              room.get('end')?.invalid
            "
            >End is required</small
          >
        </div>
        <div class="col-md-2 mt-4 pt-3">
          <span
            *ngIf="
              room.get('end')?.value != 0 &&
              room.get('start')?.value != 0 &&
              room.get('end')?.value - room.get('start')?.value >= 0
            "
            >Allocated Rooms :{{
              1 + room.get("end")?.value - room.get("start")?.value
            }}
          </span>
          <i
            class="material-symbols-rounded text-danger"
            style="vertical-align: middle; cursor: pointer"
            (click)="removeRoom(i)"
          >
            delete
          </i>
        </div>
      </div>
    </div>
    <div class="row mt-3" *ngIf="roomTypeId == 'ADD'">
      <div class="col-md-2">
        <button type="button" class="btn btn-primary" (click)="addRoom()">
          <i
            class="material-symbols-rounded"
            style="vertical-align: middle; cursor: pointer"
          >
            add
          </i>
          Add Room
        </button>
      </div>
    </div>
    <div>
      <span *ngIf="roomTypeForm.get('totalrooms')?.value"
        >Remaining Rooms {{ roomTypeForm.get("totalrooms")?.value - roomCount }}
      </span>
    </div>
    <div class="col-md-12 mt-4">
      <div class="d-flex justify-content-center">
        <button
          class="btn btn-secondary mb-3"
          type="button"
          (click)="navigateToRoomReview()"
        >
          Cancel
        </button>
        <button
          class="btn btn-primary mb-3 ms-2"
          type="button"
          (click)="onSubmit()"
        >
          {{ roomTypeId != "ADD" ? "Update" : "Add" }}
        </button>
      </div>
    </div>
  </form>
</div>
