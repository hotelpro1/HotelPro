import{a as W}from"./chunk-EH34FAH4.js";import{c as G,d as u,e as $,f as P,m as L,n as Y,o as z,p as H,x as J,y as K,z as Q}from"./chunk-HSWBAXOQ.js";import{Aa as E,Ba as N,Ca as R,Da as b,Ea as _,Eb as D,Gb as M,Hb as q,Kb as j,Lb as T,M as I,Na as l,Nb as B,Ob as U,Pa as w,Qa as k,S as v,T as x,Ya as A,fa as s,ga as h,ma as y,oa as d,pb as F,qb as O,ra as S,xa as m,xb as V,ya as n,za as C}from"./chunk-OZVGGEGK.js";function X(r,c){r&1&&(m(0,"th",7),l(1,"Action"),n())}function Z(r,c){r&1&&(m(0,"small",29),l(1," Room Name is required "),n())}function ee(r,c){r&1&&(m(0,"small",29),l(1," Room Number is required "),n())}function te(r,c){if(r&1){let a=R();m(0,"button",33),b("click",function(){v(a);let t=_(2).$implicit;return x(t.disabled?t.enable():t.disable())}),l(1," Edit "),n()}}function oe(r,c){if(r&1){let a=R();m(0,"button",34),b("click",function(){v(a);let t=_(2),o=t.$implicit,i=t.index,p=_(3).index,f=_();return x(f.editRoom(p,i,o.value))}),l(1," Save "),n()}if(r&2){let a=_(2).$implicit;d("disabled",a.invalid)}}function ie(r,c){if(r&1){let a=R();m(0,"button",35),b("click",function(){v(a);let t=_(2).index,o=_(3).index,i=_();return x(i.deleteRoom(o,t))}),l(1," Delete "),n()}}function ne(r,c){if(r&1&&(m(0,"td")(1,"div"),y(2,te,2,0,"button",30)(3,oe,2,1,"button",31)(4,ie,2,0,"button",32),n()()),r&2){let a=_().$implicit;s(2),d("ngIf",a.disabled),s(),d("ngIf",!a.disabled),s(),d("ngIf",!a.disabled)}}function re(r,c){if(r&1&&(m(0,"tr",14)(1,"th",25),l(2),n(),m(3,"td"),C(4,"input",26),y(5,Z,2,0,"small",27),n(),m(6,"td"),C(7,"input",28),y(8,ee,2,0,"small",27),n(),y(9,ne,5,3,"td",19),n()),r&2){let a,e,t=c.$implicit,o=c.index,i=_(4);d("formGroupName",o),s(2),w(" ",o+1," "),s(3),d("ngIf",(((a=t.get("roomName"))==null?null:a.dirty)||((a=t.get("roomName"))==null?null:a.touched))&&((a=t.get("roomName"))==null?null:a.invalid)),s(3),d("ngIf",(((e=t.get("roomNumber"))==null?null:e.dirty)||((e=t.get("roomNumber"))==null?null:e.touched))&&((e=t.get("roomNumber"))==null?null:e.invalid)),s(),d("ngIf",i.showActionBtn)}}function me(r,c){if(r&1&&(m(0,"table",22)(1,"thead")(2,"tr")(3,"th",7),l(4,"Sr No."),n(),m(5,"th",7),l(6,"Room Name"),n(),m(7,"th",7),l(8,"Room Number"),n(),y(9,X,2,0,"th",23),n()(),m(10,"tbody",24),y(11,re,10,5,"tr",9),n()()),r&2){let a=c.ngIf,e=_(3);s(9),d("ngIf",e.showActionBtn),s(2),d("ngForOf",a.controls)("ngForTrackBy",e.trackByFn)}}function ae(r,c){if(r&1&&(m(0,"tr")(1,"td",20),y(2,me,12,3,"table",21),n()()),r&2){let a=_().index,e=_();s(2),d("ngIf",e.getRooms(a))}}function le(r,c){if(r&1){let a=R();E(0,14),m(1,"tr")(2,"td")(3,"a",15),l(4),n()(),m(5,"td")(6,"div",16),l(7),n()(),m(8,"td")(9,"div",16),l(10),n()(),m(11,"td")(12,"button",17),b("click",function(){let t,o=v(a),i=o.$implicit,p=o.index,f=_();return x(f.addRoom(p,{roomTypeId:(t=i.get("roomTypeId"))==null?null:t.value}))}),l(13," Add Room "),n(),m(14,"i",18),b("click",function(){let t=v(a).index,o=_();return x(o.toggleRow(t))}),l(15," arrow_forward_ios "),n()()(),y(16,ae,3,1,"tr",19),N()}if(r&2){let a,e,t,o,i=c.$implicit,p=c.index,f=_();d("formGroupName",p),s(3),d("routerLink","/roomtype-setup/"+f.propertyUnitId+"/"+((a=i.get("roomTypeId"))==null?null:a.value)),s(),w(" ",(e=i.get("roomTypeName"))==null?null:e.value," "),s(3),k(" Adults- ",(t=i.get("adultOccupancy"))==null?null:t.value,",Childs-",(t=i.get("childOccupancy"))==null?null:t.value," "),s(3),w(" ",(o=i.get("active"))!=null&&o.value?"Active":"Deactive"," "),s(4),S(f.isRowExpanded(p)?"    rotate: 270deg;":"    rotate: 90deg;"),s(2),d("ngIf",f.isRowExpanded(p))}}var xe=(()=>{let c=class c{constructor(e,t,o,i,p){this.crudService=e,this.fb=t,this.alertService=o,this.activeRoute=i,this.router=p,this.columnArray=[],this.showActionBtn=!0,this.filterData=[],this.searchbox="",this.propertyUnitId="",this.expandedRowIndices=new Set}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.roomTypesForm=this.fb.group({roomTypes:this.fb.array([])}),this.loadRoomTypes()}loadRoomTypes(){this.crudService.post(T.READ_ROOMTYPE_AND_ROOMS+this.propertyUnitId).then(e=>{let t=this.roomSort(e.data);for(let o of t)this.addRoomType(o)}).catch(e=>{this.alertService.errorAlert(e?.error?.message),console.log(e)})}createRoom(e){let t=this.fb.group({roomName:[e?.roomName||"",[u.required]],roomNumber:[e?.roomNumber||"",[u.required,u.pattern("^[0-9]*$")]],roomId:[e?.roomId||""],roomTypeId:[e?.roomTypeId||"",u.required]});return e?.roomId&&t.disable(),t}addRoom(e,t){this.expandedRowIndices.add(e),this.getRooms(e).push(this.createRoom(t))}get roomTypes(){return this.roomTypesForm.get("roomTypes")}createRoomType(e={}){let t=this.fb.group({roomTypeId:[e.roomTypeId||"",u.required],roomTypeName:[e.roomTypeName||"",u.required],active:[e.active||!1],roomTypeCategory:[e.roomTypeCategory||"Room",u.required],description:[e.description||"",u.required],adultOccupancy:[e.adultOccupancy||0,[u.min(1),u.required]],childOccupancy:[e.childOccupancy||0,u.required],totalrooms:[e.rooms?.length||0,[u.min(1),u.required]],rooms:this.fb.array([])});if(e.rooms){let o=t.get("rooms");for(let i of e.rooms)o.push(this.createRoom(i))}return t}addRoomType(e){this.roomTypes.push(this.createRoomType(e))}editRoomType(e,t){this.roomTypes.at(e).patchValue(t)}deleteRoomType(e){this.roomTypes.removeAt(e)}editRoom(e,t,o){let i=this.getRooms(e).at(t),p=i.value,f=i.value.roomId?T.UPDATE_ROOM+i.value.roomId:T.CREATE_ROOM;this.crudService.post(f,p).then(g=>{console.log(g),g.data.roomId=g.data._id,i.patchValue(g.data),i.disable(),this.alertService.successAlert(g.message)}).catch(g=>{this.alertService.errorAlert(g?.error.message),console.log(g)})}deleteRoom(e,t){let o=this.getRooms(e),i=o.at(t).value.roomId;i?this.crudService.post(T.DELETE_ROOM+i).then(p=>{console.log(p),o.removeAt(t),this.alertService.successAlert(p.message)}).catch(p=>{this.alertService.errorAlert(p.message),console.log(p)}):o.removeAt(t)}trackByFn(e,t){return t.id||e}getRooms(e){return this.roomTypes.at(e).get("rooms")}toggleRow(e){this.expandedRowIndices.has(e)?this.expandedRowIndices.delete(e):this.expandedRowIndices.add(e)}isRowExpanded(e){return this.expandedRowIndices.has(e)}next(){this.router.navigate(["/policy-setup/",this.propertyUnitId])}editPropertyUnit(){this.router.navigate(["/property-setup",this.propertyUnitId])}roomSort(e){for(let t of e)t.rooms.sort((o,i)=>o.roomType<i.roomType?-1:o.roomType>i.roomType?1:o.roomName<i.roomName?-1:o.roomName>i.roomName?1:0);return e}};c.\u0275fac=function(t){return new(t||c)(h(B),h(J),h(U),h(D),h(M))},c.\u0275cmp=I({type:c,selectors:[["app-rooms-review"]],standalone:!0,features:[A],decls:28,vars:4,consts:[[1,"row","g-0"],[1,"col-9","ps-5","pe-3"],[1,"container-fluid"],[1,"col-md-12","mt-4"],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary",3,"routerLink"],[1,"table",3,"formGroup"],[1,"col"],["formArrayName","roomTypes"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-primary","mb-3",3,"click"],["type","button",1,"btn","btn-primary","mb-3","ms-2",3,"click"],[1,"col-3","px-3"],[3,"formGroupName"],[3,"routerLink"],[1,"link"],[1,"btn","btn-primary",3,"click"],[1,"material-symbols-rounded","ms-2",3,"click"],[4,"ngIf"],["colspan","4"],["class","table",4,"ngIf"],[1,"table"],["class","col",4,"ngIf"],["formArrayName","rooms"],["scope","row"],["type","text","formControlName","roomName",1,"text-center","w-100","border-0","form-control"],["class","text-danger",4,"ngIf"],["type","text","formControlName","roomNumber",1,"text-center","w-100","border-0","form-control"],[1,"text-danger"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"],["type","button","class","btn btn-primary me-2",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-primary","me-2",3,"click","disabled"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(t,o){t&1&&(m(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),l(6," Add Room Type "),n()()(),m(7,"table",6)(8,"thead")(9,"tr")(10,"th",7),l(11,"Room Type Name"),n(),m(12,"th",7),l(13,"Adult & Child"),n(),m(14,"th",7),l(15,"Status"),n(),m(16,"th",7),l(17," Action "),n()()(),m(18,"tbody",8),y(19,le,17,9,"ng-container",9),n()(),m(20,"div",3)(21,"div",10)(22,"button",11),b("click",function(){return o.editPropertyUnit()}),l(23,"Back"),n(),m(24,"button",12),b("click",function(){return o.next()}),l(25,"Next"),n()()()()(),m(26,"div",13),C(27,"app-property-sidebar"),n()()),t&2&&(s(5),d("routerLink","/roomtype-setup/"+o.propertyUnitId+"/ADD"),s(2),d("formGroup",o.roomTypesForm),s(12),d("ngForOf",o.roomTypes.controls)("ngForTrackBy",o.trackByFn))},dependencies:[V,F,O,K,G,$,P,Q,L,H,Y,z,j,q,W],styles:["table[_ngcontent-%COMP%]{text-align:center}"]});let r=c;return r})();export{xe as RoomsReviewComponent};
