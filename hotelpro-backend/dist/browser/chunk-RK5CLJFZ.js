import{a as Se,b as xe}from"./chunk-QGWSYYYR.js";import{d as Ce}from"./chunk-A2YF7YV6.js";import{c as re,d as b,e as oe,f as le,j as ae,k as se,l as de,m as me,p as ue,q as ce,r as pe,s as ge,x as he,y as _e,z as ve}from"./chunk-HSWBAXOQ.js";import{b as ne}from"./chunk-SGZRKXDW.js";import{Aa as q,Ba as B,Ca as D,Da as v,Ea as p,Eb as Y,Gb as Z,Kb as $,Lb as ee,M as j,Ma as U,Na as l,Nb as te,Oa as f,Ob as ie,Pa as P,Qa as O,S as g,T as h,Ua as I,Va as T,Wa as V,Ya as L,_a as E,a as N,b as k,fa as d,fb as J,ga as x,ma as C,oa as c,ob as z,pb as H,qb as K,ta as W,ub as Q,x as M,xa as r,xb as X,ya as o,za as G}from"./chunk-OZVGGEGK.js";var A=a=>({"is-invalid":a});function fe(a,u){a&1&&(r(0,"small",15),l(1," Arrival is required "),o())}function ye(a,u){a&1&&(r(0,"small",15),l(1," Departure is required "),o())}function Re(a,u){a&1&&(r(0,"small",15),l(1," Adults is required "),o())}function we(a,u){a&1&&(r(0,"small",15),l(1," Children is required "),o())}function Fe(a,u){a&1&&(r(0,"i",20),l(1,"person_add"),o())}function be(a,u){if(a&1&&l(0),a&2){let n=p().$implicit;P(" ","("+n.extraAdults+"/"+n.extraChilds+")"," ")}}function De(a,u){if(a&1){let n=D();r(0,"tr")(1,"td"),l(2),o(),r(3,"td"),l(4),o(),r(5,"td"),l(6),r(7,"span",19),v("click",function(){let e=g(n).$implicit,t=p(2),s=U(29);return h(t.openExtraModal(s,e))}),C(8,Fe,2,0,"i",20)(9,be,1,1),o()(),r(10,"td"),l(11),o(),r(12,"td"),l(13),o(),r(14,"td")(15,"button",21),v("click",function(){let e=g(n).index,t=p(2);return h(t.addRoomCount(e))}),r(16,"i",20),l(17,"add"),o()(),r(18,"span",22),l(19),o(),r(20,"button",23),v("click",function(){let e=g(n).index,t=p(2);return h(t.removeRoomCount(e))}),r(21,"i",20),l(22,"remove"),o()()(),r(23,"td")(24,"ng-multiselect-dropdown",24),V("ngModelChange",function(e){let t=g(n).index,s=p(2);return T(s.selectedItems[t],e)||(s.selectedItems[t]=e),h(e)}),o()()()}if(a&2){let n=u.$implicit,i=u.index,e=p(2);d(2),O("",n.roomtype," ",n.rateName,""),d(2),f(n.totalRoom-(n==null||n.dropdownSettings==null?null:n.dropdownSettings.limitSelection)),d(2),O(" ",n.adultOccupant," Adults ",n.childOccupant," Childs "),d(2),W(8,n.extraAdults==0&&n.extraChilds==0?8:9),d(3),f(n==null||n.roomPrice==null?null:n.roomPrice.toFixed(2)),d(2),f(n==null||n.roomCost==null?null:n.roomCost.toFixed(2)),d(2),c("disabled",(n==null||n.dropdownSettings==null?null:n.dropdownSettings.limitSelection)>=n.totalRoom),d(4),f(n==null||n.dropdownSettings==null?null:n.dropdownSettings.limitSelection),d(),c("disabled",(n==null||n.dropdownSettings==null?null:n.dropdownSettings.limitSelection)===0),d(4),c("placeholder","Select Room")("settings",n.dropdownSettings)("data",e.dropDownData(n.rooms,i)),I("ngModel",e.selectedItems[i])}}function Ee(a,u){if(a&1&&(r(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),l(5,"Room Type Name"),o(),r(6,"th"),l(7,"Available Rooms"),o(),r(8,"th"),l(9,"Sleeps"),o(),r(10,"th"),l(11,"Rate"),o(),r(12,"th"),l(13,"Cost"),o(),r(14,"th"),l(15,"No. of Rooms"),o(),r(16,"th"),l(17,"Room"),o()()(),r(18,"tbody"),C(19,De,25,15,"tr",18),o()()()),a&2){let n=p();d(19),c("ngForOf",n.roomsData)("ngForTrackBy",n.trackByFn)}}function Ie(a,u){if(a&1&&(q(0),l(1),B()),a&2){let n,i=p(2);d(),P(" (Total Cost ",(n=i.groupForm.get("totalCost"))==null||n.value==null?null:n.value.toFixed(2),") ")}}function Te(a,u){if(a&1){let n=D();r(0,"div",25)(1,"button",26),v("click",function(){g(n);let e=p();return h(e.onSubmit())}),l(2," Next "),C(3,Ie,2,1,"ng-container",27),o()()}if(a&2){let n=p();d(),c("disabled",!n.isOccupancySufficient),d(2),c("ngIf",n.isOccupancySufficient)}}function Ve(a,u){if(a&1){let n=D();r(0,"div",28)(1,"h4",29),l(2,"Add Adults/Children"),o(),r(3,"button",30),v("click",function(){let e=g(n).$implicit;return h(e.dismiss(!1))}),o()(),r(4,"div",31)(5,"table",17)(6,"thead")(7,"tr")(8,"th",32),l(9,"Guests"),o(),r(10,"th",32),l(11,"Rate"),o(),r(12,"th"),l(13,"Number of Extras"),o()()(),r(14,"tbody")(15,"tr")(16,"th",33),l(17,"Adults"),o(),r(18,"td"),l(19),o(),r(20,"td")(21,"select",34),V("ngModelChange",function(e){g(n);let t=p();return T(t.extraGuestsData.extraAdults,e)||(t.extraGuestsData.extraAdults=e),h(e)}),r(22,"option",35),l(23,"0"),o(),r(24,"option",36),l(25,"1"),o(),r(26,"option",37),l(27,"2"),o(),r(28,"option",38),l(29,"3"),o()()()(),r(30,"tr")(31,"th",33),l(32,"Children"),o(),r(33,"td"),l(34),o(),r(35,"td")(36,"select",34),V("ngModelChange",function(e){g(n);let t=p();return T(t.extraGuestsData.extraChilds,e)||(t.extraGuestsData.extraChilds=e),h(e)}),r(37,"option",35),l(38,"0"),o(),r(39,"option",36),l(40,"1"),o(),r(41,"option",37),l(42,"2"),o(),r(43,"option",38),l(44,"3"),o()()()()()()(),r(45,"div",39)(46,"button",40),v("click",function(){let e=g(n).$implicit;return h(e.close(!0))}),l(47," Save "),o()()}if(a&2){let n=p();d(19),f(n.extraGuestsData.adultRate),d(2),I("ngModel",n.extraGuestsData.extraAdults),d(13),f(n.extraGuestsData.childRate),d(2),I("ngModel",n.extraGuestsData.extraChilds)}}var He=(()=>{let u=class u{constructor(i,e,t,s,m,_,S){this.fb=i,this.crudService=e,this.alertService=t,this.authService=s,this.route=m,this.router=_,this.modalService=S,this.roomsData=[],this.selectedItems=[],this.propertyUnitId="",this.roomTypeRooms={},this.extraGuestsData={extraAdults:0,extraChilds:0,childRate:0,adultRate:0},this.Today="",this.isOccupancySufficient=!1}ngOnInit(){this.propertyUnitId=this.authService.getUserInfo()?.user?.propertyUnitId,this.initForms(),this.clearSession(),this.groupForm.get("adults")?.valueChanges.pipe(M()).subscribe(i=>{this.resetGuestTotals()}),this.groupForm.get("childs")?.valueChanges.pipe(M()).subscribe(i=>{this.resetGuestTotals()})}clearSession(){sessionStorage.removeItem("reservationsArray"),sessionStorage.removeItem("groupDetails"),sessionStorage.removeItem("resdata")}initForms(){let i=new Date,e=this.formatDate(i);this.Today=e;let t=this.formatDate(new Date(i.getTime()+1*24*60*60*1e3));this.groupForm=this.fb.group({arrival:[e,b.required],departure:[t,b.required],adults:[2,[b.min(1),b.required]],childs:[0,b.required],totalCost:[0],totalPrice:[0]})}nextDate(){let i=new Date(this.groupForm.get("arrival")?.value);return i.setDate(i.getDate()+1),this.formatDate(i)}setDeparture(){let i=new Date(this.groupForm.get("arrival")?.value),e=new Date(this.groupForm.get("departure")?.value);if(i>=e){let t=(e.getTime()-i.getTime())/864e5;t=t<1?1:Math.round(t),i.setDate(i.getDate()+t),this.groupForm.controls.departure.setValue(this.formatDate(i))}this.resetGuestTotals()}formatDate(i){return new Q("en-US").transform(i,"yyyy-MM-dd")||""}readRooms(){this.isOccupancySufficient=!1,this.resetGuestTotals(),this.crudService.post(ee.READ_RESERVATION_RATE+this.propertyUnitId,this.groupForm.value).then(i=>{this.processRoomsData(i.data)}).catch(i=>{this.alertService.errorAlert(i?.error?.message)})}resetGuestTotals(){this.roomsData=[],this.selectedItems=[],this.roomTypeRooms={},this.groupForm.patchValue({totalCost:0,totalPrice:0})}processRoomsData(i){this.roomsData=i.map(e=>(e.dropdownSettings={singleSelection:!1,limitSelection:0,idField:"id",textField:"roomName",unSelectAllText:"UnSelect All",enableCheckAll:!1,itemsShowLimit:3,allowSearchFilter:!0},e.extraAdults=0,e.extraChilds=0,[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.roomTypeRooms[e.roomTypeId]||(this.roomTypeRooms[e.roomTypeId]=e.rooms),this.selectedItems.push([]),e))}calculateRoomCost(i){let e=i.dateRate.reduce((s,m)=>s+Number(m.baseRate)+Number(m.adultRate*i.extraAdults)+Number(m.childRate*i.extraChilds),0),t=e*i.taxPercentage/100;return[e,e+t]}addRoomCount(i){this.updateRoomSelection(i,1)}removeRoomCount(i){this.updateRoomSelection(i,-1)}trackSelectedRooms(){let i=this.roomsData.reduce((e,t)=>e+=t.dropdownSettings.limitSelection*(t.adultOccupant+t.childOccupant+t.extraAdults+t.extraChilds),0);console.log(i),this.isOccupancySufficient=i>=this.groupForm.get("adults")?.value+this.groupForm.get("childs")?.value}updateRoomSelection(i,e){let t=this.roomsData[i];if(t.dropdownSettings=Object.assign({},t.dropdownSettings,{limitSelection:t.dropdownSettings.limitSelection+e}),this.roomsData.forEach((s,m)=>{m!==i&&s.roomTypeId===t.roomTypeId&&(s.totalRoom-=e)}),this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value+e*t.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value+e*t.roomPrice),e<0&&this.selectedItems[i].length>t.dropdownSettings.limitSelection){let s=[...this.selectedItems[i]];s.splice(s.length-1,1),this.selectedItems[i]=Object.assign(s)}this.trackSelectedRooms()}trackByFn(i,e){return e.id}dropDownData(i,e){return i.filter(t=>!this.selectedItems.some((s,m)=>m!==e&&s.some(_=>_.id===t.id)))}onSubmit(){let i=this.prepareReservationDetails();sessionStorage.setItem("resdata",JSON.stringify({reservationDetails:i,groupDetails:this.groupForm.value,roomTypeRooms:this.roomTypeRooms})),this.router.navigate(["/reservation-info"])}prepareReservationDetails(){return this.roomsData.reduce((i,e,t)=>{if(e.dropdownSettings.limitSelection>0){let s=this.createRoomDetails(e,t);return i.concat(s)}return i},[])}createRoomDetails(i,e){let t=this.selectedItems[e].map(m=>k(N({},i),{room:i,roomId:m.id})),s=Array(i.dropdownSettings.limitSelection-t.length).fill(k(N({},i),{room:{id:"assign",roomStatus:"vacant",roomCondition:"clean",roomNumber:"default",roomName:"default"},roomId:"assign"}));return t.concat(s)}openExtraModal(i,e){this.extraGuestsData={extraAdults:e.extraAdults,extraChilds:e.extraChilds,childRate:e.dateRate[0].childRate,adultRate:e.dateRate[0].adultRate},this.modalService.open(i).result.then(t=>{t&&(e.extraAdults=Number(this.extraGuestsData.extraAdults),e.extraChilds=Number(this.extraGuestsData.extraChilds),e.dropdownSettings.limitSelection>0?(this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value-e.roomCost*e.dropdownSettings.limitSelection),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value-e.roomPrice*e.dropdownSettings.limitSelection),[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value+e.roomCost*e.dropdownSettings.limitSelection),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value+e.roomPrice*e.dropdownSettings.limitSelection)):[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.trackSelectedRooms())})}};u.\u0275fac=function(e){return new(e||u)(x(he),x(te),x(ie),x(ne),x(Y),x(Z),x(Ce))},u.\u0275cmp=j({type:u,selectors:[["app-create-reservation"]],standalone:!0,features:[L],decls:30,vars:22,consts:[["extraGuests",""],[1,"container","container_form","my-3","rounded"],[3,"formGroup"],[1,"row","row-cols-1","row-cols-md-2"],[1,"col","mt-3"],[1,"form-label"],["type","date","formControlName","arrival","placeholder","Enter arrival",1,"form-control",3,"input","min","ngClass"],["class","text-danger",4,"ngIf"],["type","date","formControlName","departure","placeholder","Enter departure",1,"form-control",3,"input","min","ngClass"],["type","number","formControlName","adults","placeholder","Enter adults",1,"form-control",3,"ngClass"],["type","number","formControlName","childs","placeholder","Enter children",1,"form-control",3,"ngClass"],[1,"col","my-3"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","container-fluid text-center",4,"ngIf"],["class","container text-center",4,"ngIf"],[1,"text-danger"],[1,"container-fluid","text-center"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"link","text-primary",3,"click"],[1,"material-symbols-rounded"],[1,"btn","btn-primary","p-0","me-1",3,"click","disabled"],[1,"mx-1"],[1,"btn","btn-primary","p-0","ms-1",3,"click","disabled"],["name","roomtype",1,"multiselect_dropdown",3,"ngModelChange","placeholder","settings","data","ngModel"],[1,"container","text-center"],[1,"btn","btn-primary","my-3",3,"click","disabled"],[4,"ngIf"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["scope","col"],["scope","row"],[1,"form-control","text-center","select_reason",3,"ngModelChange","ngModel"],["value","0"],["value","1"],["value","2"],["value","3"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(e,t){if(e&1){let s=D();r(0,"div",1)(1,"form",2)(2,"div",3)(3,"div",4)(4,"label",5),l(5,"Arrival Date"),o(),r(6,"input",6),v("input",function(){return g(s),h(t.setDeparture())}),o(),C(7,fe,2,0,"small",7),o(),r(8,"div",4)(9,"label",5),l(10,"Departure Date"),o(),r(11,"input",8),v("input",function(){return g(s),h(t.resetGuestTotals())}),o(),C(12,ye,2,0,"small",7),o(),r(13,"div",4)(14,"label",5),l(15,"Adults"),o(),G(16,"input",9),C(17,Re,2,0,"small",7),o(),r(18,"div",4)(19,"label",5),l(20,"Children"),o(),G(21,"input",10),C(22,we,2,0,"small",7),o(),r(23,"div",11)(24,"button",12),v("click",function(){return g(s),h(t.readRooms())}),l(25," Show Availability "),o()()()()(),C(26,Ee,20,2,"div",13)(27,Te,4,2,"div",14)(28,Ve,48,4,"ng-template",null,0,J)}if(e&2){let s,m,_,S,y,R,w,F;d(),c("formGroup",t.groupForm),d(5),c("min",t.Today)("ngClass",E(14,A,((s=t.groupForm.get("arrival"))==null?null:s.invalid)&&(((s=t.groupForm.get("arrival"))==null?null:s.dirty)||((s=t.groupForm.get("arrival"))==null?null:s.touched)))),d(),c("ngIf",((m=t.groupForm.get("arrival"))==null?null:m.invalid)&&(((m=t.groupForm.get("arrival"))==null?null:m.dirty)||((m=t.groupForm.get("arrival"))==null?null:m.touched))),d(4),c("min",t.nextDate())("ngClass",E(16,A,((_=t.groupForm.get("departure"))==null?null:_.invalid)&&(((_=t.groupForm.get("departure"))==null?null:_.dirty)||((_=t.groupForm.get("departure"))==null?null:_.touched)))),d(),c("ngIf",((S=t.groupForm.get("departure"))==null?null:S.invalid)&&(((S=t.groupForm.get("departure"))==null?null:S.dirty)||((S=t.groupForm.get("departure"))==null?null:S.touched))),d(4),c("ngClass",E(18,A,((y=t.groupForm.get("adults"))==null?null:y.invalid)&&(((y=t.groupForm.get("adults"))==null?null:y.dirty)||((y=t.groupForm.get("adults"))==null?null:y.touched)))),d(),c("ngIf",((R=t.groupForm.get("adults"))==null?null:R.invalid)&&(((R=t.groupForm.get("adults"))==null?null:R.dirty)||((R=t.groupForm.get("adults"))==null?null:R.touched))),d(4),c("ngClass",E(20,A,((w=t.groupForm.get("childs"))==null?null:w.invalid)&&(((w=t.groupForm.get("childs"))==null?null:w.dirty)||((w=t.groupForm.get("childs"))==null?null:w.touched)))),d(),c("ngIf",((F=t.groupForm.get("childs"))==null?null:F.invalid)&&(((F=t.groupForm.get("childs"))==null?null:F.dirty)||((F=t.groupForm.get("childs"))==null?null:F.touched))),d(2),c("disabled",t.groupForm.invalid),d(2),c("ngIf",t.roomsData.length>0),d(),c("ngIf",t.roomsData.length>0)}},dependencies:[X,z,H,K,_e,se,pe,ge,re,de,ce,oe,le,ae,ve,me,ue,$,xe,Se]});let a=u;return a})();export{He as CreateReservationComponent};
