import{b as Y,c as B,d as T,e as $,f as z,k as H,l as J,m as K,n as L,o as Q,p as W,x as X,y as Z,z as ee}from"./chunk-VIVXY5RX.js";import{Ba as A,Ca as b,Da as I,Db as V,Fb as P,Ib as G,Jb as E,L as x,Lb as U,Ma as p,Mb as j,R as O,S as N,Xa as D,Za as _,ea as m,fa as S,la as v,na as a,nb as k,ob as w,pb as M,wa as l,wb as q,xa as r,ya as f}from"./chunk-CWTEAQ4G.js";var h=o=>({"is-invalid":o});function te(o,s){o&1&&(l(0,"small",19),p(1,"Room Type Name is required"),r())}function oe(o,s){o&1&&(l(0,"small",19),p(1,"Description is required"),r())}function ne(o,s){o&1&&(l(0,"small",19),p(1,"Adult Occupancy is required"),r())}function re(o,s){o&1&&(l(0,"small",19),p(1,"Child Occupancy is required"),r())}function ie(o,s){o&1&&(l(0,"small",19),p(1,"Rate is required"),r())}function le(o,s){if(o&1&&(l(0,"div",3)(1,"label",4),p(2,"Default Room Rate"),r(),f(3,"input",20),v(4,ie,2,0,"small",6),r()),o&2){let u,e,n=I();m(3),a("ngClass",_(2,h,(((u=n.roomTypeForm.get("baseRate"))==null?null:u.dirty)||((u=n.roomTypeForm.get("baseRate"))==null?null:u.touched))&&((u=n.roomTypeForm.get("baseRate"))==null?null:u.invalid))),m(),a("ngIf",(((e=n.roomTypeForm.get("baseRate"))==null?null:e.dirty)||((e=n.roomTypeForm.get("baseRate"))==null?null:e.touched))&&((e=n.roomTypeForm.get("baseRate"))==null?null:e.invalid))}}function me(o,s){o&1&&(l(0,"div",21),f(1,"input",22),l(2,"label",23),p(3,"Active"),r()())}function ae(o,s){o&1&&(l(0,"small",19),p(1,"Total Rooms is required"),r())}function pe(o,s){if(o&1&&(l(0,"div",3)(1,"label",4),p(2,"Total Rooms"),r(),f(3,"input",24),v(4,ae,2,0,"small",6),r()),o&2){let u,e,n=I();m(3),a("ngClass",_(2,h,(((u=n.roomTypeForm.get("totalrooms"))==null?null:u.dirty)||((u=n.roomTypeForm.get("totalrooms"))==null?null:u.touched))&&((u=n.roomTypeForm.get("totalrooms"))==null?null:u.invalid))),m(),a("ngIf",(((e=n.roomTypeForm.get("totalrooms"))==null?null:e.dirty)||((e=n.roomTypeForm.get("totalrooms"))==null?null:e.touched))&&((e=n.roomTypeForm.get("totalrooms"))==null?null:e.invalid))}}function ue(o,s){o&1&&(l(0,"div")(1,"p",25),p(2," Click below button to fill room details. "),r()())}function se(o,s){o&1&&(l(0,"div")(1,"p",25),p(2," There are overlapping room ranges. "),r()())}function ce(o,s){o&1&&(l(0,"small",19),p(1,"Start is required"),r())}function de(o,s){o&1&&(l(0,"small",19),p(1,"End is required"),r())}function ye(o,s){if(o&1){let u=A();l(0,"div",26)(1,"div",27)(2,"div",28)(3,"label",4),p(4,"Prefix"),r(),f(5,"input",29),r(),l(6,"div",28)(7,"label",4),p(8,"Start"),r(),f(9,"input",30),v(10,ce,2,0,"small",6),r(),l(11,"div",28)(12,"label",4),p(13,"End"),r(),f(14,"input",31),v(15,de,2,0,"small",6),r(),l(16,"div",32)(17,"i",33),b("click",function(){let n=O(u).index,t=I();return N(t.removeRoom(n))}),p(18," delete "),r()()()()}if(o&2){let u,e,n,t,i=s.$implicit,c=s.index;m(),a("formGroupName",c),m(8),a("ngClass",_(5,h,(((u=i.get("start"))==null?null:u.dirty)||((u=i.get("start"))==null?null:u.touched))&&((u=i.get("start"))==null?null:u.invalid))),m(),a("ngIf",(((e=i.get("start"))==null?null:e.dirty)||((e=i.get("start"))==null?null:e.touched))&&((e=i.get("start"))==null?null:e.invalid)),m(4),a("ngClass",_(7,h,(((n=i.get("end"))==null?null:n.dirty)||((n=i.get("end"))==null?null:n.touched))&&((n=i.get("end"))==null?null:n.invalid))),m(),a("ngIf",(((t=i.get("end"))==null?null:t.dirty)||((t=i.get("end"))==null?null:t.touched))&&((t=i.get("end"))==null?null:t.invalid))}}function ge(o,s){if(o&1){let u=A();l(0,"div",34)(1,"div",35)(2,"button",36),b("click",function(){O(u);let n=I();return N(n.addRoom())}),l(3,"i",37),p(4," add "),r(),p(5," Add Room "),r()()()}}var Ie=(()=>{let s=class s{constructor(e,n,t,i,c){this.crudService=e,this.fb=n,this.alertService=t,this.activeRoute=i,this.router=c,this.propertyUnitId="",this.roomTypeId="ADD"}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.roomTypeId=this.activeRoute.snapshot.paramMap.get("roomTypeId"),this.roomTypeForm=this.fb.group({roomTypeName:["",T.required],active:[!0],description:[""],adultOccupancy:[0,[T.min(1),T.required]],childOccupancy:[0,T.required],baseRate:[0],rooms:this.fb.array([])},{validators:[this.totalRoomsValidator(),this.noOverlappingRanges()]}),this.roomTypeId&&this.roomTypeId!="ADD"?this.crudService.post(E.READ_ROOMTYPE_BY_ID+this.roomTypeId).then(e=>{console.log(e),this.roomTypeForm.reset(e.data)}).catch(e=>{this.alertService.errorAlert(e.message),this.router.navigate(["/roomtype-setup/"+this.propertyUnitId+"/ADD"]),this.ngOnInit()}):this.roomTypeForm.addControl("totalrooms",this.fb.control(0,[T.min(1),T.required]))}get rooms(){return this.roomTypeForm.get("rooms")}createRoomGroup(e){return this.fb.group({prefix:[e?.prefix||""],start:[e?.start||"",T.required],end:[e?.end||"",T.required]})}addRoom(e){this.rooms.push(this.createRoomGroup(e))}onSubmit(){this.roomTypeForm.valid?(console.log(this.roomTypeForm.value),this.roomTypeId=="ADD"?this.crudService.post(E.CREATE_ROOMTYPE_AND_ROOMS+this.propertyUnitId,this.roomTypeForm.value).then(e=>{console.log(e),this.alertService.successAlert(e.message),this.navigateToRoomReview()}).catch(e=>{this.alertService.errorAlert(e.message)}):this.crudService.post(E.UPDATE_ROOM_TYPE+this.roomTypeId,this.roomTypeForm.value).then(e=>{console.log(e),this.alertService.successAlert(e.message),this.navigateToRoomReview()}).catch(e=>{this.alertService.errorAlert(e.message)})):this.roomTypeForm.markAllAsTouched()}removeRoom(e){this.rooms.removeAt(e)}totalRoomsValidator(){return e=>{let n=e.get("totalrooms")?.value,t=e.get("rooms");if(!n||!t)return null;let i=0;return t.controls.forEach(c=>{let d=parseInt(c.get("start")?.value,10),y=parseInt(c.get("end")?.value,10);d&&y&&(i+=y-d+1)}),i===n?null:{totalRoomsMismatch:!0}}}noOverlappingRanges(){return e=>{let n=e.get("rooms");if(!n)return null;let t=[],i=!1;return n.controls.forEach(c=>{let d=parseInt(c.get("start")?.value,10),y=parseInt(c.get("end")?.value,10);if(d&&y){for(let g of t)if(d>=g.start&&d<=g.end||y>=g.start&&y<=g.end||d<=g.start&&y>=g.end){i=!0;break}t.push({start:d,end:y})}}),i?{overlappingRanges:!0}:null}}navigateToRoomReview(){this.router.navigate(["/rooms-review",this.propertyUnitId])}};s.\u0275fac=function(n){return new(n||s)(S(U),S(X),S(j),S(V),S(P))},s.\u0275cmp=x({type:s,selectors:[["app-room-type-range-setup"]],standalone:!0,features:[D],decls:36,vars:24,consts:[[1,"container","container_form","my-3","rounded"],[3,"formGroup"],[1,"row","row-cols-1","row-cols-md-2"],[1,"col","mt-3"],[1,"form-label"],["type","text","formControlName","roomTypeName","placeholder","Enter Room Type Name",1,"form-control",3,"ngClass"],["class","text-danger",4,"ngIf"],["type","text","formControlName","description","placeholder","Enter Description",1,"form-control",3,"ngClass"],["type","number","formControlName","adultOccupancy",1,"form-control",3,"ngClass"],["type","number","formControlName","childOccupancy",1,"form-control",3,"ngClass"],["class","col mt-3",4,"ngIf"],["class","col mt-3 ms-3 form-check",4,"ngIf"],[4,"ngIf"],["formArrayName","rooms","class","mt-4 border-top",4,"ngFor","ngForOf"],["class","row mt-3",4,"ngIf"],[1,"col-md-12","mt-4"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-primary","mb-3",3,"click"],["type","button",1,"btn","btn-primary","mb-3","ms-2",3,"click"],[1,"text-danger"],["type","number","formControlName","baseRate",1,"form-control",3,"ngClass"],[1,"col","mt-3","ms-3","form-check"],["type","checkbox","formControlName","active",1,"form-check-input"],[1,"form-check-label"],["type","number","formControlName","totalrooms",1,"form-control",3,"ngClass"],[1,"text-danger","mt-2"],["formArrayName","rooms",1,"mt-4","border-top"],[1,"row","mt-3",3,"formGroupName"],[1,"col-md-2","mt-2"],["type","text","formControlName","prefix","placeholder","Prefix",1,"form-control"],["type","number","formControlName","start","placeholder","Start",1,"form-control",3,"ngClass"],["type","number","formControlName","end","placeholder","End",1,"form-control",3,"ngClass"],[1,"col-md-2","mt-4","pt-2"],[1,"material-symbols-rounded","text-danger","pt-2",2,"vertical-align","middle","cursor","pointer",3,"click"],[1,"row","mt-3"],[1,"col-md-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"material-symbols-rounded",2,"vertical-align","middle","cursor","pointer"]],template:function(n,t){if(n&1&&(l(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),p(5,"Room Type Name"),r(),f(6,"input",5),v(7,te,2,0,"small",6),r(),l(8,"div",3)(9,"label",4),p(10,"Description"),r(),f(11,"input",7),v(12,oe,2,0,"small",6),r(),l(13,"div",3)(14,"label",4),p(15,"Adult Occupancy"),r(),f(16,"input",8),v(17,ne,2,0,"small",6),r(),l(18,"div",3)(19,"label",4),p(20,"Child Occupancy"),r(),f(21,"input",9),v(22,re,2,0,"small",6),r(),v(23,le,5,4,"div",10)(24,me,4,0,"div",11)(25,pe,5,4,"div",10),r(),v(26,ue,3,0,"div",12)(27,se,3,0,"div",12)(28,ye,19,9,"div",13)(29,ge,6,0,"div",14),l(30,"div",15)(31,"div",16)(32,"button",17),b("click",function(){return t.navigateToRoomReview()}),p(33," Cancel "),r(),l(34,"button",18),b("click",function(){return t.onSubmit()}),p(35," Submit "),r()()()()()),n&2){let i,c,d,y,g,R,C,F;m(),a("formGroup",t.roomTypeForm),m(5),a("ngClass",_(16,h,(((i=t.roomTypeForm.get("roomTypeName"))==null?null:i.dirty)||((i=t.roomTypeForm.get("roomTypeName"))==null?null:i.touched))&&((i=t.roomTypeForm.get("roomTypeName"))==null?null:i.invalid))),m(),a("ngIf",(((c=t.roomTypeForm.get("roomTypeName"))==null?null:c.dirty)||((c=t.roomTypeForm.get("roomTypeName"))==null?null:c.touched))&&((c=t.roomTypeForm.get("roomTypeName"))==null?null:c.invalid)),m(4),a("ngClass",_(18,h,(((d=t.roomTypeForm.get("description"))==null?null:d.dirty)||((d=t.roomTypeForm.get("description"))==null?null:d.touched))&&((d=t.roomTypeForm.get("description"))==null?null:d.invalid))),m(),a("ngIf",(((y=t.roomTypeForm.get("description"))==null?null:y.dirty)||((y=t.roomTypeForm.get("description"))==null?null:y.touched))&&((y=t.roomTypeForm.get("description"))==null?null:y.invalid)),m(4),a("ngClass",_(20,h,(((g=t.roomTypeForm.get("adultOccupancy"))==null?null:g.dirty)||((g=t.roomTypeForm.get("adultOccupancy"))==null?null:g.touched))&&((g=t.roomTypeForm.get("adultOccupancy"))==null?null:g.invalid))),m(),a("ngIf",(((R=t.roomTypeForm.get("adultOccupancy"))==null?null:R.dirty)||((R=t.roomTypeForm.get("adultOccupancy"))==null?null:R.touched))&&((R=t.roomTypeForm.get("adultOccupancy"))==null?null:R.invalid)),m(4),a("ngClass",_(22,h,(((C=t.roomTypeForm.get("childOccupancy"))==null?null:C.dirty)||((C=t.roomTypeForm.get("childOccupancy"))==null?null:C.touched))&&((C=t.roomTypeForm.get("childOccupancy"))==null?null:C.invalid))),m(),a("ngIf",(((F=t.roomTypeForm.get("childOccupancy"))==null?null:F.dirty)||((F=t.roomTypeForm.get("childOccupancy"))==null?null:F.touched))&&((F=t.roomTypeForm.get("childOccupancy"))==null?null:F.invalid)),m(),a("ngIf",t.roomTypeId=="ADD"),m(),a("ngIf",t.roomTypeId!="ADD"),m(),a("ngIf",t.roomTypeId=="ADD"),m(),a("ngIf",t.roomTypeForm.errors==null?null:t.roomTypeForm.errors.totalRoomsMismatch),m(),a("ngIf",t.roomTypeForm.errors==null?null:t.roomTypeForm.errors.overlappingRanges),m(),a("ngForOf",t.rooms.controls),m(),a("ngIf",t.roomTypeId=="ADD")}},dependencies:[q,k,w,M,Z,H,B,J,Y,$,z,ee,K,W,L,Q,G],styles:[".form-label[_ngcontent-%COMP%]{margin-bottom:0}.form-control.is-invalid[_ngcontent-%COMP%]{background-image:none;padding-right:.375rem .75rem}.container_form[_ngcontent-%COMP%]{background:#00000023}"]});let o=s;return o})();export{Ie as RoomTypeRangeSetupComponent};
