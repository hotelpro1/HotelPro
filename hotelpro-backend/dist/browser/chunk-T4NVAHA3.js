import{a as de,b as me}from"./chunk-LIPDJV2Z.js";import{d as oe}from"./chunk-24LOKUE6.js";import{c as H,d as g,e as J,f as K,k as Q,l as W,m as X,p as Z,q as ee,r as te,s as ie,u as ne,x as le,y as re,z as ae}from"./chunk-VIVXY5RX.js";import{b as z}from"./chunk-SWGOWEHE.js";import{Ba as Y,Ca as S,Da as x,Fb as L,Ib as G,Jb as w,L as V,La as P,Lb as $,Ma as l,Mb as B,Na as F,Oa as b,R as h,S as f,Xa as A,Ya as M,Za as v,a as T,b as I,bb as R,db as N,ea as a,eb as k,fa as D,la as _,na as o,nb as U,ob as O,pb as q,tb as C,wa as t,wb as j,xa as e,ya as y}from"./chunk-CWTEAQ4G.js";var pe=m=>({selected:m}),E=m=>({"is-invalid":m}),ce=()=>({singleSelection:!1,idField:"roomTypeId",textField:"roomTypeName",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:2,allowSearchFilter:!0});function se(m,s){if(m&1){let d=Y();t(0,"tr",13),S("click",function(){let r=h(d),c=r.$implicit,p=r.index,u=x();return f(u.selectYield(c,p))}),t(1,"td"),l(2),e(),t(3,"td"),l(4),e(),t(5,"td"),l(6),R(7,"date"),e(),t(8,"td"),l(9),R(10,"date"),e(),t(11,"td"),l(12),e(),t(13,"td"),l(14),e(),t(15,"td"),l(16),e()()}if(m&2){let d=s.$implicit,i=s.index,r=x();o("ngClass",v(14,pe,r.selectedYieldIndex===i)),a(2),F(i+1),a(2),F(d.yieldName),a(2),F(N(7,8,d.startDate,"dd-MM-yyyy")),a(3),F(N(10,11,d.endDate,"dd-MM-yyyy")),a(3),F(d==null||d.ratePlanDetail==null?null:d.ratePlanDetail.ratePlanName),a(2),F(r.getRoomTypeNames(d.roomTypes)),a(2),F(d.active?"Active":"Deactive")}}function ue(m,s){m&1&&(t(0,"p",40),l(1," Enter valid Date! "),e())}function ye(m,s){m&1&&(t(0,"p",40),l(1," Enter valid Date! "),e())}function ge(m,s){if(m&1&&(t(0,"option",33),l(1),e()),m&2){let d=s.$implicit;o("value",d.item_id),a(),b(" ",d.item_text," ")}}function _e(m,s){m&1&&(t(0,"small",40),l(1," Room type is required "),e())}function ve(m,s){if(m&1){let d=Y();t(0,"div",3)(1,"div",14),l(2,"Yield Details"),e(),t(3,"div",7)(4,"form",15)(5,"table",16)(6,"tr")(7,"td")(8,"div",17),l(9,"Start Date*:"),e()(),t(10,"td")(11,"input",18),S("input",function(){h(d);let r=x();return f(r.getTomorrow())}),e(),_(12,ue,2,0,"p",19),e()(),t(13,"tr")(14,"td")(15,"div",17),l(16,"End Date*:"),e()(),t(17,"td"),y(18,"input",20),_(19,ye,2,0,"p",19),e()(),t(20,"tr")(21,"td",21)(22,"div"),l(23,"Yield Name* :"),e()(),t(24,"td"),y(25,"input",22),e()(),t(26,"tr")(27,"td",21)(28,"div"),l(29,"Description* :"),e()(),t(30,"td"),y(31,"input",23),e()(),t(32,"tr")(33,"td")(34,"div",17),l(35,"Rate Plan* :"),e()(),t(36,"td")(37,"div")(38,"select",24),_(39,ge,2,2,"option",25),e(),_(40,_e,2,0,"small",19),e()()(),t(41,"tr")(42,"td",21)(43,"div"),l(44,"Room Type* :"),e()(),t(45,"td"),y(46,"ng-multiselect-dropdown",26),e()(),t(47,"tr")(48,"td",21)(49,"div"),l(50,"Occupancy Range* :"),e()(),t(51,"td")(52,"div",27)(53,"div"),y(54,"input",28),e(),t(55,"div",29),l(56," To(%) "),e(),t(57,"div"),y(58,"input",30),e()()()(),t(59,"tr")(60,"td",21)(61,"div"),l(62,"Rate Change* :"),e()(),t(63,"td")(64,"div",27)(65,"div",31)(66,"select",32)(67,"option",33),l(68,"Percentage"),e(),t(69,"option",33),l(70,"Flat"),e()()(),t(71,"div",34),y(72,"input",35),e()()()(),t(73,"tr")(74,"td",21)(75,"div"),l(76,"Status :"),e()(),t(77,"td")(78,"select",36)(79,"option",33),l(80,"Active"),e(),t(81,"option",33),l(82,"Deactive"),e()()()()(),t(83,"div",37)(84,"button",38),S("click",function(){h(d);let r=x();return f(r.ngOnInit())}),l(85," CANCEL "),e(),t(86,"button",39),S("click",function(){h(d);let r=x();return f(r.updateYield())}),l(87," Update "),e()()()()()}if(m&2){let d,i,r,c,p,u,n=x();a(4),o("formGroup",n.yieldForm),a(7),o("min",n.Today),a(),o("ngIf",n.yieldForm.controls.startDate.touched&&n.yieldForm.controls.startDate.invalid),a(6),o("min",n.Tomorrow),a(),o("ngIf",n.yieldForm.controls.endDate.touched&&n.yieldForm.controls.endDate.invalid),a(6),o("ngClass",v(23,E,((d=n.yieldForm.get("yieldName"))==null?null:d.invalid)&&(((d=n.yieldForm.get("yieldName"))==null?null:d.dirty)||((d=n.yieldForm.get("yieldName"))==null?null:d.touched)))),a(6),o("ngClass",v(25,E,((i=n.yieldForm.get("yieldDescription"))==null?null:i.invalid)&&(((i=n.yieldForm.get("yieldDescription"))==null?null:i.dirty)||((i=n.yieldForm.get("yieldDescription"))==null?null:i.touched)))),a(8),o("ngForOf",n.RatePlanList),a(),o("ngIf",((r=n.yieldForm.get("ratePlanSetupId"))==null?null:r.invalid)&&((r=n.yieldForm.get("ratePlanSetupId"))==null?null:r.touched)),a(6),o("placeholder","Select Roomtype")("settings",M(27,ce))("data",n.RoomTypes),a(8),o("min",0)("ngClass",v(28,E,((c=n.yieldForm.get("occupancyRangeStart"))==null?null:c.invalid)&&(((c=n.yieldForm.get("occupancyRangeStart"))==null?null:c.dirty)||((c=n.yieldForm.get("occupancyRangeStart"))==null?null:c.touched)))),a(4),o("min",0)("ngClass",v(30,E,((p=n.yieldForm.get("occupancyRangeEnd"))==null?null:p.invalid)&&(((p=n.yieldForm.get("occupancyRangeEnd"))==null?null:p.dirty)||((p=n.yieldForm.get("occupancyRangeEnd"))==null?null:p.touched)))),a(9),o("value","percentage"),a(2),o("value","flat"),a(3),o("min",0)("ngClass",v(32,E,((u=n.yieldForm.get("changeValue"))==null?null:u.invalid)&&(((u=n.yieldForm.get("changeValue"))==null?null:u.dirty)||((u=n.yieldForm.get("changeValue"))==null?null:u.touched)))),a(7),o("value",!0),a(2),o("value",!1),a(5),o("disabled",!n.yieldForm.valid)}}function he(m,s){m&1&&(t(0,"p",40),l(1," Enter valid Date! "),e())}function fe(m,s){m&1&&(t(0,"p",40),l(1," Enter valid Date! "),e())}function Se(m,s){if(m&1&&(t(0,"option",33),l(1),e()),m&2){let d=s.$implicit;o("value",d.item_id),a(),b(" ",d.item_text," ")}}function xe(m,s){m&1&&(t(0,"small",40),l(1," Room type is required "),e())}function Ee(m,s){if(m&1){let d=Y();t(0,"div",41)(1,"h4",42),l(2,"Create yield"),e(),t(3,"button",43),S("click",function(){let r=h(d).$implicit;return f(r.dismiss(!1))}),e()(),t(4,"form",44)(5,"table",16)(6,"tr")(7,"td")(8,"div",17),l(9,"Start Date*:"),e()(),t(10,"td")(11,"input",18),S("input",function(){h(d);let r=x();return f(r.getTomorrow())}),e(),_(12,he,2,0,"p",19),e()(),t(13,"tr")(14,"td")(15,"div",17),l(16,"End Date*:"),e()(),t(17,"td"),y(18,"input",20),_(19,fe,2,0,"p",19),e()(),t(20,"tr")(21,"td",21)(22,"div"),l(23,"Yield Name* :"),e()(),t(24,"td"),y(25,"input",22),e()(),t(26,"tr")(27,"td",21)(28,"div"),l(29,"Description* :"),e()(),t(30,"td"),y(31,"input",23),e()(),t(32,"tr")(33,"td")(34,"div",17),l(35,"Rate Plan* :"),e()(),t(36,"td")(37,"div")(38,"select",24),_(39,Se,2,2,"option",25),e(),_(40,xe,2,0,"small",19),e()()(),t(41,"tr")(42,"td",21)(43,"div"),l(44,"Room Type* :"),e()(),t(45,"td"),y(46,"ng-multiselect-dropdown",26),e()(),t(47,"tr")(48,"td",21)(49,"div"),l(50,"Occupancy Range* :"),e()(),t(51,"td")(52,"div",27)(53,"div"),y(54,"input",28),e(),t(55,"div",29),l(56," To(%) "),e(),t(57,"div"),y(58,"input",30),e()()()(),t(59,"tr")(60,"td",21)(61,"div"),l(62,"Rate Change* :"),e()(),t(63,"td")(64,"div",27)(65,"div",31)(66,"select",32)(67,"option",33),l(68,"Percentage"),e(),t(69,"option",33),l(70,"Flat"),e()()(),t(71,"div",34),y(72,"input",35),e()()()()(),t(73,"div",37)(74,"button",38),S("click",function(){let r=h(d).$implicit;return f(r.close("Close click"))}),l(75," CANCEL "),e(),t(76,"button",39),S("click",function(){h(d);let r=x();return f(r.createYield())}),l(77," Save "),e()()()}if(m&2){let d,i,r,c,p,u,n=x();a(4),o("formGroup",n.createYieldForm),a(7),o("min",n.Today),a(),o("ngIf",n.createYieldForm.controls.startDate.touched&&n.createYieldForm.controls.startDate.invalid),a(6),o("min",n.Tomorrow),a(),o("ngIf",n.createYieldForm.controls.endDate.touched&&n.createYieldForm.controls.endDate.invalid),a(6),o("ngClass",v(21,E,((d=n.createYieldForm.get("yieldName"))==null?null:d.invalid)&&(((d=n.createYieldForm.get("yieldName"))==null?null:d.dirty)||((d=n.createYieldForm.get("yieldName"))==null?null:d.touched)))),a(6),o("ngClass",v(23,E,((i=n.createYieldForm.get("yieldDescription"))==null?null:i.invalid)&&(((i=n.createYieldForm.get("yieldDescription"))==null?null:i.dirty)||((i=n.createYieldForm.get("yieldDescription"))==null?null:i.touched)))),a(8),o("ngForOf",n.RatePlanList),a(),o("ngIf",((r=n.createYieldForm.get("ratePlanSetupId"))==null?null:r.invalid)&&((r=n.createYieldForm.get("ratePlanSetupId"))==null?null:r.touched)),a(6),o("placeholder","Select Roomtype")("settings",M(25,ce))("data",n.RoomTypes),a(8),o("min",0)("ngClass",v(26,E,((c=n.createYieldForm.get("occupancyRangeStart"))==null?null:c.invalid)&&(((c=n.createYieldForm.get("occupancyRangeStart"))==null?null:c.dirty)||((c=n.createYieldForm.get("occupancyRangeStart"))==null?null:c.touched)))),a(4),o("min",0)("ngClass",v(28,E,((p=n.createYieldForm.get("occupancyRangeEnd"))==null?null:p.invalid)&&(((p=n.createYieldForm.get("occupancyRangeEnd"))==null?null:p.dirty)||((p=n.createYieldForm.get("occupancyRangeEnd"))==null?null:p.touched)))),a(9),o("value","percentage"),a(2),o("value","flat"),a(3),o("min",0)("ngClass",v(30,E,((u=n.createYieldForm.get("changeValue"))==null?null:u.invalid)&&(((u=n.createYieldForm.get("changeValue"))==null?null:u.dirty)||((u=n.createYieldForm.get("changeValue"))==null?null:u.touched)))),a(4),o("disabled",!n.createYieldForm.valid)}}var ke=(()=>{let s=class s{constructor(i,r,c,p,u,n){this.crudService=i,this.fb=r,this.alertService=c,this.router=p,this.modalService=u,this.authService=n,this.propertyUnitId="",this.selectedYieldIndex=0}ngOnInit(){this.propertyUnitId=this.authService.getUserInfo()?.user?.propertyUnitId,this.Today=new C("en-US").transform(new Date,"yyyy-MM-dd"),this.Tomorrow=new Date(this.Today),this.Tomorrow.setDate(this.Tomorrow.getDate()+1),this.Tomorrow=new C("en-US").transform(this.Tomorrow,"yyyy-MM-dd"),this.initForms(),this.fetchData()}initForms(){let i={yieldName:["",[g.required]],yieldDescription:["",[g.required]],ratePlanSetupId:["",[g.required]],roomTypeIds:[[],[g.required]],startDate:[this.Today,[g.required]],endDate:[this.Tomorrow,[g.required]],occupancyRangeStart:[0,[g.required,g.pattern("[0-9]+(.[0-9]{1,2})?%?")]],occupancyRangeEnd:[0,[g.required,g.pattern("[0-9]+(.[0-9]{1,2})?%?")]],changeType:["percentage"],changeValue:[0,[g.required,g.pattern("[0-9]+(.[0-9]{1,2})?%?")]]};this.createYieldForm=this.fb.group(T({},i)),this.yieldForm=this.fb.group(I(T({},i),{active:[!0,[g.required]],yieldId:["",[g.required]]}))}fetchData(){this.crudService.post(w.READ_YIELD,{propertyUnitId:this.propertyUnitId}).then(i=>{console.log(i.data),this.yieldData=i.data.yieldDetails,console.log(this.yieldData),this.RoomTypes=i.data.roomType,this.RatePlanList=i.data.ratePlan.map(r=>({item_id:r.ratePlanId,item_text:r.ratePlanName})),this.createYieldForm.patchValue({ratePlanSetupId:this.RatePlanList[0].item_id}),this.yieldData&&this.yieldData.length>0&&this.selectYield(this.yieldData[0],0)}).catch(i=>{this.alertService.errorAlert(i?.error?.message||"An error occurred while fetching yield")})}createYield(){if(this.createYieldForm.valid){let i=I(T({},this.createYieldForm.value),{propertyUnitId:this.propertyUnitId});console.log(i),this.crudService.post(w.CREATE_YIELD,i).then(()=>{this.alertService.successAlert("Yield created successfully")}).catch(r=>{this.alertService.errorAlert(r?.error?.message||"An error occurred while create the yield")}).finally(()=>{this.fetchData(),this.modalService.dismissAll()})}}selectYield(i,r){this.selectedYieldIndex=r;let c=i.roomTypes.map(p=>({roomTypeId:p._id,roomTypeName:p.roomTypeName}));this.yieldForm.patchValue({yieldId:i._id,yieldName:i.yieldName,yieldDescription:i.yieldDescription,ratePlanSetupId:i.ratePlanDetail._id,roomTypeIds:c,startDate:new C("en-US").transform(i.startDate,"yyyy-MM-dd"),endDate:new C("en-US").transform(i.endDate,"yyyy-MM-dd"),occupancyRangeStart:i.occupancyRangeStart,occupancyRangeEnd:i.occupancyRangeEnd,changeType:i.changeType,changeValue:i.changeValue,active:i.active})}updateYield(){if(this.yieldForm.valid){if(this.yieldForm.controls.startDate.value?.toString()>=this.yieldForm.controls.endDate.value?.toString()){this.alertService.errorAlert("Please select valid dates");return}let i=T({},this.yieldForm.value);this.crudService.post(w.UPDATE_YIELD,i).then(()=>{this.alertService.successAlert("Yield updated successfully")}).catch(r=>{this.alertService.errorAlert(r?.error?.message||"An error occurred while updating the yield"),console.error(r)}).finally(()=>{this.fetchData()})}}getTomorrow(){this.Tomorrow=new Date(this.createYieldForm.controls.startDate.value),this.Tomorrow.setDate(this.Tomorrow.getDate()+1),this.Tomorrow=new C("en-US").transform(this.Tomorrow,"yyyy-MM-dd"),this.createYieldForm.controls.startDate.value?.toString()>=this.createYieldForm.controls.endDate.value?.toString()&&this.createYieldForm.patchValue({endDate:this.Tomorrow})}getRoomTypeNames(i){return i.map(r=>r.roomTypeName).sort().join(" ")}openModalCreateYield(i){this.createYieldForm.patchValue({yieldName:"",yieldDescription:"",ratePlanSetupId:"",roomTypeIds:[],startDate:this.Today,endDate:this.Tomorrow,occupancyRangeStart:0,occupancyRangeEnd:0,changeType:"percentage",changeValue:0}),this.modalService.open(i,{centered:!0})}};s.\u0275fac=function(r){return new(r||s)(D($),D(le),D(B),D(L),D(oe),D(z))},s.\u0275cmp=V({type:s,selectors:[["app-yield-management"]],standalone:!0,features:[A],decls:32,vars:2,consts:[["addYield",""],[1,"row","mt-4"],[1,"col-lg-8","col-md-8","col-sm-12"],[1,"card"],[1,"card-header","d-flex","justify-content-between"],[1,"align-content-center"],[1,"btn","btn-success","button",3,"click"],[1,"card-body"],[1,"table","text-center"],["scope","col"],["style","cursor: pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"col-lg-4","col-md-4","col-sm-12"],["class","card",4,"ngIf"],[2,"cursor","pointer",3,"click","ngClass"],[1,"card-header"],[3,"formGroup"],[1,"table","table-sm","table-borderless","add_table"],[1,"mt-1"],["type","date","formControlName","startDate",1,"form-control","field",3,"input","min"],["class","text-danger",4,"ngIf"],["type","date","formControlName","endDate",1,"form-control","field",3,"min"],[1,"custom_label"],["type","text","formControlName","yieldName",1,"form-control","field",3,"ngClass"],["type","text","formControlName","yieldDescription",1,"form-control","field",3,"ngClass"],["id","options","formControlName","ratePlanSetupId",1,"form-control",2,"appearance","auto"],[3,"value",4,"ngFor","ngForOf"],["name","roomtype","formControlName","roomTypeIds",1,"multiselect_dropdown",3,"placeholder","settings","data"],[1,"d-flex","justify-content-between","p-0"],["type","number","formControlName","occupancyRangeStart","placeholder","0",1,"form-control","field",3,"min","ngClass"],[1,"d-flex","align-items-center"],["type","number","formControlName","occupancyRangeEnd","placeholder","0",1,"form-control","field",3,"min","ngClass"],[2,"width","70%"],["id","active","formControlName","changeType",1,"form-control"],[3,"value"],[1,"ms-2"],["type","number","formControlName","changeValue","placeholder","0",1,"form-control","field",3,"min","ngClass"],["id","active","formControlName","active",1,"form-control"],[1,"d-flex","justify-content-center","pb-3"],[1,"btn","light_button","button",3,"click"],[1,"btn","btn-success","button","ms-2",3,"click","disabled"],[1,"text-danger"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"px-2","mt-2","fix_height",3,"formGroup"]],template:function(r,c){if(r&1){let p=Y();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),l(5,"Yields"),e(),t(6,"div",6),S("click",function(){h(p);let n=P(31);return f(c.openModalCreateYield(n))}),l(7," Create Yield "),e()(),t(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th",9),l(13,"No."),e(),t(14,"th",9),l(15,"Name"),e(),t(16,"th",9),l(17,"Start date"),e(),t(18,"th",9),l(19,"End date"),e(),t(20,"th",9),l(21,"Rate plan"),e(),t(22,"th",9),l(23,"Room type"),e(),t(24,"th",9),l(25,"Status"),e()()(),t(26,"tbody"),_(27,se,17,16,"tr",10),e()()()()(),t(28,"div",11),_(29,ve,88,34,"div",12),e()(),_(30,Ee,78,32,"ng-template",null,0,k)}r&2&&(a(27),o("ngForOf",c.yieldData),a(2),o("ngIf",(c.yieldData==null?null:c.yieldData.length)>0))},dependencies:[j,U,O,q,C,re,Q,te,ie,H,W,ee,J,K,ne,ae,X,Z,G,me,de],styles:[".selected[_ngcontent-%COMP%]{background-color:#f0f8ff;font-weight:700}.add_table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{width:35%}"]});let m=s;return m})();export{ke as YieldManagementComponent};
