import{c as $,d as f,e as z,f as H,k as J,l as K,m as L,n as Q,o as W,p as X,x as Z,y as ee,z as te}from"./chunk-VIVXY5RX.js";import{Ba as D,Ca as O,Da as I,Db as U,Fb as G,Ib as j,Jb as N,L as q,Lb as Y,Ma as p,Mb as B,R as A,S as x,Xa as M,Za as _,ea as i,fa as E,la as v,na as m,nb as w,ob as k,pb as V,wa as a,wb as P,xa as n,ya as T}from"./chunk-CWTEAQ4G.js";var h=o=>({"is-invalid":o});function oe(o,s){o&1&&(a(0,"small",18),p(1,"Room Type Name is required"),n())}function re(o,s){o&1&&(a(0,"small",18),p(1,"Room Type Category is required"),n())}function ne(o,s){o&1&&(a(0,"small",18),p(1,"Description is required"),n())}function le(o,s){o&1&&(a(0,"small",18),p(1,"Adult Occupancy is required"),n())}function ie(o,s){o&1&&(a(0,"small",18),p(1,"Child Occupancy is required"),n())}function me(o,s){o&1&&(a(0,"small",18),p(1,"Rate is required"),n())}function ae(o,s){if(o&1&&(a(0,"div",3)(1,"label",4),p(2,"Default Rate"),n(),T(3,"input",19),v(4,me,2,0,"small",6),n()),o&2){let u,t,r=I();i(3),m("ngClass",_(2,h,(((u=r.roomTypeForm.get("baseRate"))==null?null:u.dirty)||((u=r.roomTypeForm.get("baseRate"))==null?null:u.touched))&&((u=r.roomTypeForm.get("baseRate"))==null?null:u.invalid))),i(),m("ngIf",(((t=r.roomTypeForm.get("baseRate"))==null?null:t.dirty)||((t=r.roomTypeForm.get("baseRate"))==null?null:t.touched))&&((t=r.roomTypeForm.get("baseRate"))==null?null:t.invalid))}}function pe(o,s){o&1&&(a(0,"small",18),p(1,"Total Rooms is required"),n())}function ue(o,s){if(o&1&&(a(0,"div",3)(1,"label",4),p(2,"Total Rooms"),n(),T(3,"input",20),v(4,pe,2,0,"small",6),n()),o&2){let u,t,r=I();i(3),m("ngClass",_(2,h,(((u=r.roomTypeForm.get("totalrooms"))==null?null:u.dirty)||((u=r.roomTypeForm.get("totalrooms"))==null?null:u.touched))&&((u=r.roomTypeForm.get("totalrooms"))==null?null:u.invalid))),i(),m("ngIf",(((t=r.roomTypeForm.get("totalrooms"))==null?null:t.dirty)||((t=r.roomTypeForm.get("totalrooms"))==null?null:t.touched))&&((t=r.roomTypeForm.get("totalrooms"))==null?null:t.invalid))}}function se(o,s){o&1&&(a(0,"div")(1,"p",21),p(2," The total number of rooms does not match the sum of the ranges. "),n()())}function de(o,s){o&1&&(a(0,"div")(1,"p",21),p(2," There are overlapping room ranges. "),n()())}function ce(o,s){o&1&&(a(0,"small",18),p(1,"Start is required"),n())}function ye(o,s){o&1&&(a(0,"small",18),p(1,"End is required"),n())}function ge(o,s){if(o&1){let u=D();a(0,"div",22)(1,"div",23)(2,"div",24)(3,"label",4),p(4,"Prefix"),n(),T(5,"input",25),n(),a(6,"div",24)(7,"label",4),p(8,"Start"),n(),T(9,"input",26),v(10,ce,2,0,"small",6),n(),a(11,"div",24)(12,"label",4),p(13,"End"),n(),T(14,"input",27),v(15,ye,2,0,"small",6),n(),a(16,"div",28)(17,"i",29),O("click",function(){let r=A(u).index,e=I();return x(e.removeRoom(r))}),p(18," delete "),n()()()()}if(o&2){let u,t,r,e,l=s.$implicit,d=s.index;i(),m("formGroupName",d),i(8),m("ngClass",_(5,h,(((u=l.get("start"))==null?null:u.dirty)||((u=l.get("start"))==null?null:u.touched))&&((u=l.get("start"))==null?null:u.invalid))),i(),m("ngIf",(((t=l.get("start"))==null?null:t.dirty)||((t=l.get("start"))==null?null:t.touched))&&((t=l.get("start"))==null?null:t.invalid)),i(4),m("ngClass",_(7,h,(((r=l.get("end"))==null?null:r.dirty)||((r=l.get("end"))==null?null:r.touched))&&((r=l.get("end"))==null?null:r.invalid))),i(),m("ngIf",(((e=l.get("end"))==null?null:e.dirty)||((e=l.get("end"))==null?null:e.touched))&&((e=l.get("end"))==null?null:e.invalid))}}function ve(o,s){if(o&1){let u=D();a(0,"div",30)(1,"div",31)(2,"button",32),O("click",function(){A(u);let r=I();return x(r.addRoom())}),a(3,"i",33),p(4," add "),n(),p(5," Add Room "),n()()()}}var Ie=(()=>{let s=class s{constructor(t,r,e,l,d){this.crudService=t,this.fb=r,this.alertService=e,this.activeRoute=l,this.router=d,this.propertyUnitId="",this.roomTypeId="ADD"}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.roomTypeId=this.activeRoute.snapshot.paramMap.get("roomTypeId"),this.roomTypeForm=this.fb.group({roomTypeName:["",f.required],active:[!1],roomTypeCategory:["Room",f.required],description:["",f.required],adultOccupancy:[0,[f.min(1),f.required]],childOccupancy:[0,f.required],baseRate:[0,f.required],rooms:this.fb.array([])},{validators:[this.totalRoomsValidator(),this.noOverlappingRanges()]}),this.roomTypeId&&this.roomTypeId!="ADD"?this.crudService.post(N.READ_ROOMTYPE_BY_ID+this.roomTypeId).then(t=>{console.log(t),this.roomTypeForm.reset(t.data),this.alertService.successAlert(t.message)}).catch(t=>{this.alertService.errorAlert(t.message),this.router.navigate(["/roomtype-setup/"+this.propertyUnitId+"/ADD"]),this.ngOnInit()}):this.roomTypeForm.addControl("totalrooms",this.fb.control(0,[f.min(1),f.required]))}get rooms(){return this.roomTypeForm.get("rooms")}createRoomGroup(t){return this.fb.group({prefix:[t?.prefix||""],start:[t?.start||"",f.required],end:[t?.end||"",f.required]})}addRoom(t){this.rooms.push(this.createRoomGroup(t))}onSubmit(){this.roomTypeForm.valid?(console.log(this.roomTypeForm.value),this.roomTypeId=="ADD"?this.crudService.post(N.CREATE_ROOMTYPE_AND_ROOMS+this.propertyUnitId,this.roomTypeForm.value).then(t=>{console.log(t),this.alertService.successAlert(t.message),this.router.navigate(["/rooms-review/"+this.propertyUnitId])}).catch(t=>{this.alertService.errorAlert(t.message)}):this.crudService.post(N.UPDATE_ROOM_TYPE+this.roomTypeId,this.roomTypeForm.value).then(t=>{console.log(t),this.alertService.successAlert(t.message),this.router.navigate(["/rooms-review/"+this.propertyUnitId])}).catch(t=>{this.alertService.errorAlert(t.message)})):console.error("Form is invalid")}removeRoom(t){this.rooms.removeAt(t)}totalRoomsValidator(){return t=>{let r=t.get("totalrooms")?.value,e=t.get("rooms");if(!r||!e)return null;let l=0;return e.controls.forEach(d=>{let c=parseInt(d.get("start")?.value,10),y=parseInt(d.get("end")?.value,10);c&&y&&(l+=y-c+1)}),l===r?null:{totalRoomsMismatch:!0}}}noOverlappingRanges(){return t=>{let r=t.get("rooms");if(!r)return null;let e=[],l=!1;return r.controls.forEach(d=>{let c=parseInt(d.get("start")?.value,10),y=parseInt(d.get("end")?.value,10);if(c&&y){for(let g of e)if(c>=g.start&&c<=g.end||y>=g.start&&y<=g.end||c<=g.start&&y>=g.end){l=!0;break}e.push({start:c,end:y})}}),l?{overlappingRanges:!0}:null}}};s.\u0275fac=function(r){return new(r||s)(E(Y),E(Z),E(B),E(U),E(G))},s.\u0275cmp=q({type:s,selectors:[["app-room-type-range-setup"]],standalone:!0,features:[M],decls:38,vars:27,consts:[[1,"container","container_form","my-3","rounded"],[3,"formGroup"],[1,"row","row-cols-1","row-cols-md-2"],[1,"col","mt-3"],[1,"form-label"],["type","text","formControlName","roomTypeName","placeholder","Enter Room Type Name",1,"form-control",3,"ngClass"],["class","text-danger",4,"ngIf"],["type","text","formControlName","roomTypeCategory","placeholder","Enter Room Type Category",1,"form-control",3,"ngClass"],["type","text","formControlName","description","placeholder","Enter Description",1,"form-control",3,"ngClass"],["type","number","formControlName","adultOccupancy",1,"form-control",3,"ngClass"],["type","number","formControlName","childOccupancy",1,"form-control",3,"ngClass"],["class","col mt-3",4,"ngIf"],[4,"ngIf"],["formArrayName","rooms","class","mt-4 border-top",4,"ngFor","ngForOf"],["class","row mt-3",4,"ngIf"],[1,"col-md-12","mt-4"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-primary","mb-3",3,"click"],[1,"text-danger"],["type","number","formControlName","baseRate",1,"form-control",3,"ngClass"],["type","number","formControlName","totalrooms",1,"form-control",3,"ngClass"],[1,"text-danger","text-center","mt-2"],["formArrayName","rooms",1,"mt-4","border-top"],[1,"row","mt-3",3,"formGroupName"],[1,"col-md-2","mt-2"],["type","text","formControlName","prefix","placeholder","Prefix",1,"form-control"],["type","number","formControlName","start","placeholder","Start",1,"form-control",3,"ngClass"],["type","number","formControlName","end","placeholder","End",1,"form-control",3,"ngClass"],[1,"col-md-2","mt-4","pt-2"],[1,"material-symbols-rounded","text-danger","pt-2",2,"vertical-align","middle","cursor","pointer",3,"click"],[1,"row","mt-3"],[1,"col-md-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"material-symbols-rounded",2,"vertical-align","middle","cursor","pointer"]],template:function(r,e){if(r&1&&(a(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),p(5,"Room Type Name"),n(),T(6,"input",5),v(7,oe,2,0,"small",6),n(),a(8,"div",3)(9,"label",4),p(10,"Room Type Category"),n(),T(11,"input",7),v(12,re,2,0,"small",6),n(),a(13,"div",3)(14,"label",4),p(15,"Description"),n(),T(16,"input",8),v(17,ne,2,0,"small",6),n(),a(18,"div",3)(19,"label",4),p(20,"Adult Occupancy"),n(),T(21,"input",9),v(22,le,2,0,"small",6),n(),a(23,"div",3)(24,"label",4),p(25,"Child Occupancy"),n(),T(26,"input",10),v(27,ie,2,0,"small",6),n(),v(28,ae,5,4,"div",11)(29,ue,5,4,"div",11),n(),v(30,se,3,0,"div",12)(31,de,3,0,"div",12)(32,ge,19,9,"div",13)(33,ve,6,0,"div",14),a(34,"div",15)(35,"div",16)(36,"button",17),O("click",function(){return e.onSubmit()}),p(37," Submit "),n()()()()()),r&2){let l,d,c,y,g,R,C,F,S,b;i(),m("formGroup",e.roomTypeForm),i(5),m("ngClass",_(17,h,(((l=e.roomTypeForm.get("roomTypeName"))==null?null:l.dirty)||((l=e.roomTypeForm.get("roomTypeName"))==null?null:l.touched))&&((l=e.roomTypeForm.get("roomTypeName"))==null?null:l.invalid))),i(),m("ngIf",(((d=e.roomTypeForm.get("roomTypeName"))==null?null:d.dirty)||((d=e.roomTypeForm.get("roomTypeName"))==null?null:d.touched))&&((d=e.roomTypeForm.get("roomTypeName"))==null?null:d.invalid)),i(4),m("ngClass",_(19,h,(((c=e.roomTypeForm.get("roomTypeCategory"))==null?null:c.dirty)||((c=e.roomTypeForm.get("roomTypeCategory"))==null?null:c.touched))&&((c=e.roomTypeForm.get("roomTypeCategory"))==null?null:c.invalid))),i(),m("ngIf",(((y=e.roomTypeForm.get("roomTypeCategory"))==null?null:y.dirty)||((y=e.roomTypeForm.get("roomTypeCategory"))==null?null:y.touched))&&((y=e.roomTypeForm.get("roomTypeCategory"))==null?null:y.invalid)),i(4),m("ngClass",_(21,h,(((g=e.roomTypeForm.get("description"))==null?null:g.dirty)||((g=e.roomTypeForm.get("description"))==null?null:g.touched))&&((g=e.roomTypeForm.get("description"))==null?null:g.invalid))),i(),m("ngIf",(((R=e.roomTypeForm.get("description"))==null?null:R.dirty)||((R=e.roomTypeForm.get("description"))==null?null:R.touched))&&((R=e.roomTypeForm.get("description"))==null?null:R.invalid)),i(4),m("ngClass",_(23,h,(((C=e.roomTypeForm.get("adultOccupancy"))==null?null:C.dirty)||((C=e.roomTypeForm.get("adultOccupancy"))==null?null:C.touched))&&((C=e.roomTypeForm.get("adultOccupancy"))==null?null:C.invalid))),i(),m("ngIf",(((F=e.roomTypeForm.get("adultOccupancy"))==null?null:F.dirty)||((F=e.roomTypeForm.get("adultOccupancy"))==null?null:F.touched))&&((F=e.roomTypeForm.get("adultOccupancy"))==null?null:F.invalid)),i(4),m("ngClass",_(25,h,(((S=e.roomTypeForm.get("childOccupancy"))==null?null:S.dirty)||((S=e.roomTypeForm.get("childOccupancy"))==null?null:S.touched))&&((S=e.roomTypeForm.get("childOccupancy"))==null?null:S.invalid))),i(),m("ngIf",(((b=e.roomTypeForm.get("childOccupancy"))==null?null:b.dirty)||((b=e.roomTypeForm.get("childOccupancy"))==null?null:b.touched))&&((b=e.roomTypeForm.get("childOccupancy"))==null?null:b.invalid)),i(),m("ngIf",e.roomTypeId=="ADD"),i(),m("ngIf",e.roomTypeId=="ADD"),i(),m("ngIf",e.roomTypeForm.errors==null?null:e.roomTypeForm.errors.totalRoomsMismatch),i(),m("ngIf",e.roomTypeForm.errors==null?null:e.roomTypeForm.errors.overlappingRanges),i(),m("ngForOf",e.rooms.controls),i(),m("ngIf",e.roomTypeId=="ADD")}},dependencies:[P,w,k,V,ee,J,$,K,z,H,te,L,X,Q,W,j],styles:[".form-label[_ngcontent-%COMP%]{margin-bottom:0}.form-control.is-invalid[_ngcontent-%COMP%]{background-image:none;padding-right:.375rem .75rem}.container_form[_ngcontent-%COMP%]{background:#00000023}"]});let o=s;return o})();export{Ie as RoomTypeRangeSetupComponent};
