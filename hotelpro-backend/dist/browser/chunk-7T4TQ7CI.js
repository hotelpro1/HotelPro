import{a as xe,b as ve}from"./chunk-QGWSYYYR.js";import{d as Ce}from"./chunk-A2YF7YV6.js";import{c as le,d as E,e as ne,f as re,j as oe,k as ae,l as se,m as ue,p as de,q as me,r as ce,s as pe,x as _e,y as ge,z as he}from"./chunk-HSWBAXOQ.js";import{b as ie}from"./chunk-SGZRKXDW.js";import{Aa as q,Ba as B,Ca as I,Da as x,Ea as p,Eb as X,Gb as Y,Kb as Z,Lb as $,M as P,Ma as j,Na as o,Nb as ee,Oa as w,Ob as te,Pa as G,Qa as W,S as _,T as g,Ua as R,Va as T,Wa as k,Ya as U,_a as b,a as M,b as N,fa as u,fb as L,ga as f,ma as C,oa as c,ob as J,pb as z,qb as H,ta as O,ub as K,xa as n,xb as Q,ya as l,za as A}from"./chunk-OZVGGEGK.js";var V=a=>({"is-invalid":a});function fe(a,d){a&1&&(n(0,"small",15),o(1," Arrival is required "),l())}function Se(a,d){a&1&&(n(0,"small",15),o(1," Departure is required "),l())}function ye(a,d){a&1&&(n(0,"small",15),o(1," Adults is required "),l())}function Fe(a,d){a&1&&(n(0,"small",15),o(1," Children is required "),l())}function De(a,d){a&1&&(n(0,"i",20),o(1,"person_add"),l())}function we(a,d){if(a&1&&o(0),a&2){let r=p().$implicit;G(" ","("+r.extraAdults+"/"+r.extraChilds+")"," ")}}function Ee(a,d){if(a&1){let r=I();n(0,"tr")(1,"td"),o(2),l(),n(3,"td"),o(4),l(),n(5,"td"),o(6),n(7,"span",19),x("click",function(){let e=_(r).$implicit,t=p(2),s=j(29);return g(t.openExtraModal(s,e))}),C(8,De,2,0,"i",20)(9,we,1,1),l()(),n(10,"td"),o(11),l(),n(12,"td"),o(13),l(),n(14,"td")(15,"ng-multiselect-dropdown",21),k("ngModelChange",function(e){let t=_(r).index,s=p(2);return T(s.selectedItems[t],e)||(s.selectedItems[t]=e),g(e)}),x("onSelect",function(e){let t=_(r).index,s=p(2);return g(s.onItemSelect(e,t))})("onDeSelect",function(e){let t=_(r).index,s=p(2);return g(s.onItemDeSelect(e,t))}),l()()()}if(a&2){let r=d.$implicit,i=d.index,e=p(2);u(2),W("",r.roomtype," ",r.rateName,""),u(2),w(r.totalRoom),u(2),W(" ",r.adultOccupant," Adults ",r.childOccupant," Childs "),u(2),O(8,r.extraAdults==0&&r.extraChilds==0?8:9),u(3),w(r==null||r.roomPrice==null?null:r.roomPrice.toFixed(2)),u(2),w(r==null||r.roomCost==null?null:r.roomCost.toFixed(2)),u(2),c("placeholder","Select Room")("settings",r.dropdownSettings)("data",e.dropDownData(r.rooms,i)),R("ngModel",e.selectedItems[i])}}function Ie(a,d){if(a&1&&(n(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),o(5,"Room Type Name"),l(),n(6,"th"),o(7,"Available Rooms"),l(),n(8,"th"),o(9,"Sleeps"),l(),n(10,"th"),o(11,"Rate"),l(),n(12,"th"),o(13,"Cost"),l(),n(14,"th"),o(15,"Room"),l()()(),n(16,"tbody"),C(17,Ee,16,12,"tr",18),l()()()),a&2){let r=p();u(17),c("ngForOf",r.roomsData)("ngForTrackBy",r.trackByFn)}}function be(a,d){if(a&1&&(q(0),o(1),B()),a&2){let r,i=p(2);u(),G(" (Total Cost ",(r=i.groupForm.get("totalCost"))==null||r.value==null?null:r.value.toFixed(2),") ")}}function Re(a,d){if(a&1){let r=I();n(0,"div",22)(1,"button",23),x("click",function(){_(r);let e=p();return g(e.onSubmit())}),o(2," Next "),C(3,be,2,1,"ng-container",24),l()()}if(a&2){let r,i,e=p();u(),c("disabled",(e.totalGuests==null?null:e.totalGuests.adults)+(e.totalGuests==null?null:e.totalGuests.childs)<((r=e.groupForm.get("adults"))==null?null:r.value)+((r=e.groupForm.get("childs"))==null?null:r.value)),u(2),c("ngIf",(e.totalGuests==null?null:e.totalGuests.adults)+(e.totalGuests==null?null:e.totalGuests.childs)>=((i=e.groupForm.get("adults"))==null?null:i.value)+((i=e.groupForm.get("childs"))==null?null:i.value))}}function Te(a,d){if(a&1){let r=I();n(0,"div",25)(1,"h4",26),o(2,"Add Adults/Children"),l(),n(3,"button",27),x("click",function(){let e=_(r).$implicit;return g(e.dismiss(!1))}),l()(),n(4,"div",28)(5,"table",17)(6,"thead")(7,"tr")(8,"th",29),o(9,"Guests"),l(),n(10,"th",29),o(11,"Rate"),l(),n(12,"th"),o(13,"Number of Extras"),l()()(),n(14,"tbody")(15,"tr")(16,"th",30),o(17,"Adults"),l(),n(18,"td"),o(19),l(),n(20,"td")(21,"select",31),k("ngModelChange",function(e){_(r);let t=p();return T(t.extraGuestsData.extraAdults,e)||(t.extraGuestsData.extraAdults=e),g(e)}),n(22,"option",32),o(23,"0"),l(),n(24,"option",33),o(25,"1"),l(),n(26,"option",34),o(27,"2"),l(),n(28,"option",35),o(29,"3"),l()()()(),n(30,"tr")(31,"th",30),o(32,"Children"),l(),n(33,"td"),o(34),l(),n(35,"td")(36,"select",31),k("ngModelChange",function(e){_(r);let t=p();return T(t.extraGuestsData.extraChilds,e)||(t.extraGuestsData.extraChilds=e),g(e)}),n(37,"option",32),o(38,"0"),l(),n(39,"option",33),o(40,"1"),l(),n(41,"option",34),o(42,"2"),l(),n(43,"option",35),o(44,"3"),l()()()()()()(),n(45,"div",36)(46,"button",37),x("click",function(){let e=_(r).$implicit;return g(e.close(!0))}),o(47," Save "),l()()}if(a&2){let r=p();u(19),w(r.extraGuestsData.adultRate),u(2),R("ngModel",r.extraGuestsData.extraAdults),u(13),w(r.extraGuestsData.childRate),u(2),R("ngModel",r.extraGuestsData.extraChilds)}}var Je=(()=>{let d=class d{constructor(i,e,t,s,m,h,v){this.fb=i,this.crudService=e,this.alertService=t,this.authService=s,this.route=m,this.router=h,this.modalService=v,this.roomsData=[],this.selectedItems=[],this.totalGuests={adults:0,childs:0},this.propertyUnitId="",this.roomTypeRooms={},this.extraGuestsData={extraAdults:0,extraChilds:0,childRate:0,adultRate:0},this.Today=""}ngOnInit(){this.propertyUnitId=this.authService.getUserInfo()?.user?.propertyUnitId,this.initForms(),this.clearSession()}clearSession(){sessionStorage.removeItem("reservationsArray"),sessionStorage.removeItem("groupDetails"),sessionStorage.removeItem("resdata")}initForms(){let i=new Date,e=this.formatDate(i);this.Today=e;let t=this.formatDate(new Date(i.getTime()+1*24*60*60*1e3));this.groupForm=this.fb.group({arrival:[e,E.required],departure:[t,E.required],adults:[2,[E.min(1),E.required]],childs:[0,E.required],totalCost:[0],totalPrice:[0]})}nextDate(){let i=new Date(this.groupForm.get("arrival")?.value);return i.setDate(i.getDate()+1),this.formatDate(i)}setDeparture(){let i=new Date(this.groupForm.get("arrival")?.value),e=new Date(this.groupForm.get("departure")?.value);if(i>=e){let t=(e.getTime()-i.getTime())/864e5;t=t<1?1:Math.round(t),i.setDate(i.getDate()+t),this.groupForm.controls.departure.setValue(this.formatDate(i))}this.resetGuestTotals()}formatDate(i){return new K("en-US").transform(i,"yyyy-MM-dd")||""}readRooms(){this.resetGuestTotals(),this.crudService.post($.READ_RESERVATION_RATE+this.propertyUnitId,this.groupForm.value).then(i=>{this.processRoomsData(i.data)}).catch(i=>{this.alertService.errorAlert(i?.error?.message)})}resetGuestTotals(){this.roomsData=[],this.selectedItems=[],this.roomTypeRooms={},this.totalGuests={adults:0,childs:0},this.groupForm.patchValue({totalCost:0,totalPrice:0})}processRoomsData(i){this.roomsData=i.map(e=>(e.dropdownSettings={singleSelection:!1,idField:"id",textField:"roomName",unSelectAllText:"UnSelect All",enableCheckAll:!1,itemsShowLimit:3,allowSearchFilter:!0},e.extraAdults=0,e.extraChilds=0,[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.roomTypeRooms[e.roomTypeId]||(this.roomTypeRooms[e.roomTypeId]=e.rooms),this.selectedItems.push([]),e))}calculateRoomCost(i){let e=i.dateRate.reduce((s,m)=>s+Number(m.baseRate)+Number(m.adultRate*i.extraAdults)+Number(m.childRate*i.extraChilds),0),t=e*i.taxPercentage/100;return[e,e+t]}updateRoomSelection(i,e){let t=this.roomsData[i];this.roomsData.forEach((s,m)=>{s.roomTypeId===t.roomTypeId&&(s.totalRoom-=e)}),this.totalGuests.adults+=e*t.adultOccupant,this.totalGuests.childs+=e*t.childOccupant,this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value+e*t.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value+e*t.roomPrice)}onItemDeSelect(i,e){this.updateRoomSelection(e,-1)}onItemSelect(i,e){this.updateRoomSelection(e,1)}trackByFn(i,e){return e.id}dropDownData(i,e){return i.filter(t=>!this.selectedItems.some((s,m)=>m!==e&&s.some(h=>h.id===t.id)))}onSubmit(){let i=this.prepareReservationDetails();sessionStorage.setItem("resdata",JSON.stringify({reservationDetails:i,groupDetails:this.groupForm.value,roomTypeRooms:this.roomTypeRooms})),this.router.navigate(["/walkin-info"])}prepareReservationDetails(){return this.roomsData.reduce((i,e,t)=>{let s=this.createRoomDetails(e,t);return i.concat(s)},[])}createRoomDetails(i,e){return this.selectedItems[e].map(s=>N(M({},i),{room:i,roomId:s.id}))}openExtraModal(i,e){this.extraGuestsData={extraAdults:e.extraAdults,extraChilds:e.extraChilds,childRate:e.dateRate[0].childRate,adultRate:e.dateRate[0].adultRate},this.modalService.open(i).result.then(t=>{t&&(this.totalGuests.adults-=e.adultOccupant+e.extraAdults,this.totalGuests.childs-=e.childOccupant+e.extraChilds,e.extraAdults=Number(this.extraGuestsData.extraAdults),e.extraChilds=Number(this.extraGuestsData.extraChilds),this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value-e.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value-e.roomPrice),[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.totalGuests.adults+=e.adultOccupant+e.extraAdults,this.totalGuests.childs+=e.childOccupant+e.extraChilds,this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value+e.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value+e.roomPrice))})}};d.\u0275fac=function(e){return new(e||d)(f(_e),f(ee),f(te),f(ie),f(X),f(Y),f(Ce))},d.\u0275cmp=P({type:d,selectors:[["app-create-walkin"]],standalone:!0,features:[U],decls:30,vars:22,consts:[["extraGuests",""],[1,"container","container_form","my-3","rounded"],[3,"formGroup"],[1,"row","row-cols-1","row-cols-md-2"],[1,"col","mt-3"],[1,"form-label"],["type","date","formControlName","arrival","placeholder","Enter arrival","readonly","",1,"form-control",3,"input","min","ngClass"],["class","text-danger",4,"ngIf"],["type","date","formControlName","departure","placeholder","Enter departure",1,"form-control",3,"input","min","ngClass"],["type","number","formControlName","adults","placeholder","Enter adults",1,"form-control",3,"ngClass"],["type","number","formControlName","childs","placeholder","Enter children",1,"form-control",3,"ngClass"],[1,"col","my-3"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","container-fluid text-center",4,"ngIf"],["class","container text-center",4,"ngIf"],[1,"text-danger"],[1,"container-fluid","text-center"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"link","text-primary",3,"click"],[1,"material-symbols-rounded"],["name","roomtype",1,"multiselect_dropdown",3,"ngModelChange","onSelect","onDeSelect","placeholder","settings","data","ngModel"],[1,"container","text-center"],[1,"btn","btn-primary","my-3",3,"click","disabled"],[4,"ngIf"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["scope","col"],["scope","row"],[1,"form-control","text-center","select_reason",3,"ngModelChange","ngModel"],["value","0"],["value","1"],["value","2"],["value","3"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(e,t){if(e&1){let s=I();n(0,"div",1)(1,"form",2)(2,"div",3)(3,"div",4)(4,"label",5),o(5,"CheckIn Date"),l(),n(6,"input",6),x("input",function(){return _(s),g(t.setDeparture())}),l(),C(7,fe,2,0,"small",7),l(),n(8,"div",4)(9,"label",5),o(10,"Checkout Date"),l(),n(11,"input",8),x("input",function(){return _(s),g(t.resetGuestTotals())}),l(),C(12,Se,2,0,"small",7),l(),n(13,"div",4)(14,"label",5),o(15,"Adults"),l(),A(16,"input",9),C(17,ye,2,0,"small",7),l(),n(18,"div",4)(19,"label",5),o(20,"Children"),l(),A(21,"input",10),C(22,Fe,2,0,"small",7),l(),n(23,"div",11)(24,"button",12),x("click",function(){return _(s),g(t.readRooms())}),o(25," Show Availability "),l()()()()(),C(26,Ie,18,2,"div",13)(27,Re,4,2,"div",14)(28,Te,48,4,"ng-template",null,0,L)}if(e&2){let s,m,h,v,S,y,F,D;u(),c("formGroup",t.groupForm),u(5),c("min",t.Today)("ngClass",b(14,V,((s=t.groupForm.get("arrival"))==null?null:s.invalid)&&(((s=t.groupForm.get("arrival"))==null?null:s.dirty)||((s=t.groupForm.get("arrival"))==null?null:s.touched)))),u(),c("ngIf",((m=t.groupForm.get("arrival"))==null?null:m.invalid)&&(((m=t.groupForm.get("arrival"))==null?null:m.dirty)||((m=t.groupForm.get("arrival"))==null?null:m.touched))),u(4),c("min",t.nextDate())("ngClass",b(16,V,((h=t.groupForm.get("departure"))==null?null:h.invalid)&&(((h=t.groupForm.get("departure"))==null?null:h.dirty)||((h=t.groupForm.get("departure"))==null?null:h.touched)))),u(),c("ngIf",((v=t.groupForm.get("departure"))==null?null:v.invalid)&&(((v=t.groupForm.get("departure"))==null?null:v.dirty)||((v=t.groupForm.get("departure"))==null?null:v.touched))),u(4),c("ngClass",b(18,V,((S=t.groupForm.get("adults"))==null?null:S.invalid)&&(((S=t.groupForm.get("adults"))==null?null:S.dirty)||((S=t.groupForm.get("adults"))==null?null:S.touched)))),u(),c("ngIf",((y=t.groupForm.get("adults"))==null?null:y.invalid)&&(((y=t.groupForm.get("adults"))==null?null:y.dirty)||((y=t.groupForm.get("adults"))==null?null:y.touched))),u(4),c("ngClass",b(20,V,((F=t.groupForm.get("childs"))==null?null:F.invalid)&&(((F=t.groupForm.get("childs"))==null?null:F.dirty)||((F=t.groupForm.get("childs"))==null?null:F.touched)))),u(),c("ngIf",((D=t.groupForm.get("childs"))==null?null:D.invalid)&&(((D=t.groupForm.get("childs"))==null?null:D.dirty)||((D=t.groupForm.get("childs"))==null?null:D.touched))),u(2),c("disabled",t.groupForm.invalid),u(2),c("ngIf",t.roomsData.length>0),u(),c("ngIf",t.roomsData.length>0)}},dependencies:[Q,J,z,H,ge,ae,ce,pe,le,se,me,ne,re,oe,he,ue,de,Z,ve,xe]});let a=d;return a})();export{Je as CreateWalkinComponent};
