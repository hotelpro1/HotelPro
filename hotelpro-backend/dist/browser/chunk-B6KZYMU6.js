import{b as U,c as q,d as C,e as G,f as M,k as J,l as Y,m as $,p as z,x as H,z as K}from"./chunk-JTMYAVLC.js";import{b as w}from"./chunk-AZK4NKSV.js";import{Ba as I,Ca as g,Da as F,Db as R,Fb as B,Jb as V,L as E,Lb as j,Ma as r,Mb as O,Na as x,Oa as _,R as b,S as k,Xa as A,Za as S,ea as l,fa as y,la as v,na as p,nb as D,ob as P,pb as T,wa as i,wb as N,xa as t,ya as f}from"./chunk-IHM353DK.js";var L=a=>({"is-invalid":a});function Q(a,m){a&1&&(i(0,"small",19),r(1," amount is required "),t())}function W(a,m){a&1&&(i(0,"small",19),r(1," remark is required "),t())}function X(a,m){if(a&1){let c=I();i(0,"tr")(1,"td"),r(2),t(),i(3,"td"),r(4),t(),i(5,"td"),r(6),t(),i(7,"td")(8,"i",23),g("click",function(){let n=b(c).index,e=F(2);return k(e.removePaymnetObj(n))}),r(9," delete "),t()()()}if(a&2){let c=m.$implicit;l(2),_(" ",c.amount," "),l(2),_(" ",c.deposit?"Yes":"No"," "),l(2),_(" ",c.remark," ")}}function Z(a,m){if(a&1&&(i(0,"div",20)(1,"table",21)(2,"thead")(3,"tr")(4,"th"),r(5,"Amount"),t(),i(6,"th"),r(7,"Deposit"),t(),i(8,"th"),r(9,"remark"),t(),i(10,"th"),r(11,"Action"),t()()(),i(12,"tbody"),v(13,X,10,3,"tr",22),t()()()),a&2){let c=F();l(13),p("ngForOf",c.paymentEntries)("ngForTrackBy",c.trackByFn)}}var pe=(()=>{let m=class m{constructor(o,n,e,s,u,d){this.fb=o,this.route=n,this.router=e,this.alertService=s,this.authService=u,this.crudService=d,this.paymentEntries=[],this.propertyUnitId="",this.currentBalance=0}ngOnInit(){this.propertyUnitId=this.authService.getUserInfo()?.user?.propertyUnitId,this.paymentForm=this.fb.group({paymentType:["cash"],amount:[10,[C.min(1),C.required]],deposit:[!1,C.required],remark:[""]});let o=sessionStorage.getItem("reservationsArray"),n=sessionStorage.getItem("groupDetails");o&&n&&(this.reservationsArray=JSON.parse(o),this.groupDetails=JSON.parse(n),this.groupDetails.totalTax=this.groupDetails.totalCost-this.groupDetails.totalPrice,this.groupDetails.totalBalance=-this.groupDetails.totalCost,this.groupDetails.totalPayment=0,this.groupDetails.totalDeposit=0,this.paymentForm.controls.amount.patchValue(this.groupDetails.totalCost),this.currentBalance=this.groupDetails.totalCost)}onAddPayment(){this.paymentForm.valid&&(this.paymentEntries.push(this.paymentForm.value),this.paymentForm.get("deposit")?.value||(this.currentBalance-=this.paymentForm.get("amount")?.value),this.paymentForm.patchValue({paymentType:"cash",amount:this.currentBalance,deposit:!1,remark:""}))}onPayment(){let o={propertyUnitId:this.propertyUnitId,reservationsArray:this.reservationsArray,groupDetails:this.groupDetails,paymentEntries:this.paymentEntries};this.crudService.post(V.CREATE_RESERVATION,o).then(n=>{console.log(n),this.alertService.successAlert("Reservation created successfully"),this.router.navigate(["/guest-folio/"+n?.data?._id])}).catch(n=>{this.alertService.errorAlert(n?.error?.message||"An error occurred while processing payment"),console.error(n)})}trackByFn(o,n){return o}removePaymnetObj(o){this.paymentEntries[o].deposit||(this.currentBalance+=this.paymentEntries[o].amount,this.paymentForm.patchValue({paymentType:"cash",amount:this.currentBalance,deposit:!1,remark:""})),this.paymentEntries.splice(o,1)}};m.\u0275fac=function(n){return new(n||m)(y(H),y(R),y(B),y(O),y(w),y(j))},m.\u0275cmp=E({type:m,selectors:[["app-create-reservation-payment"]],standalone:!0,features:[A],decls:30,vars:12,consts:[[1,"container","container_form","my-3","pb-3","rounded"],[1,"form-label","mt-2"],[1,"fw-semibold"],[3,"formGroup"],[1,"row"],[1,"col-md-4","mt-3","col-9"],[1,"form-label"],["type","number","formControlName","amount","placeholder","Enter amount",1,"form-control",3,"ngClass"],["class","text-danger",4,"ngIf"],[1,"col-md-2","col-3","mt-3"],[1,"mt-4"],[1,"form-label","me-2"],["type","checkbox","formControlName","deposit",1,"form-check-input"],[1,"col-md-4","col-9","mt-3"],["type","text","formControlName","remark","placeholder","Enter remark",1,"form-control",3,"ngClass"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-primary","mt-4",3,"click","disabled"],["class","container-fluid text-center",4,"ngIf"],[1,"btn","btn-primary","mt-2","me-2",3,"click"],[1,"text-danger"],[1,"container-fluid","text-center"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"material-symbols-rounded","text-danger","pt-2",2,"vertical-align","middle","cursor","pointer",3,"click"]],template:function(n,e){if(n&1&&(i(0,"div",0)(1,"label",1),r(2," Total Balance : "),i(3,"span",2),r(4),t()(),i(5,"form",3)(6,"div",4)(7,"div",5)(8,"label",6),r(9,"Amount "),t(),f(10,"input",7),v(11,Q,2,0,"small",8),t(),i(12,"div",9)(13,"div",10)(14,"label",11),r(15,"Deposit "),t(),f(16,"input",12),t()(),i(17,"div",13)(18,"label",6),r(19,"Remark "),t(),f(20,"input",14),v(21,W,2,0,"small",8),t(),i(22,"div",9)(23,"div",15)(24,"button",16),g("click",function(){return e.onAddPayment()}),r(25," Add "),t()()()()()(),v(26,Z,14,2,"div",17),i(27,"div",15)(28,"button",18),g("click",function(){return e.onPayment()}),r(29," Payment "),t()()),n&2){let s,u,d,h;l(4),x(e.currentBalance),l(),p("formGroup",e.paymentForm),l(5),p("ngClass",S(8,L,((s=e.paymentForm.get("amount"))==null?null:s.invalid)&&(((s=e.paymentForm.get("amount"))==null?null:s.dirty)||((s=e.paymentForm.get("amount"))==null?null:s.touched)))),l(),p("ngIf",((u=e.paymentForm.get("amount"))==null?null:u.invalid)&&(((u=e.paymentForm.get("amount"))==null?null:u.dirty)||((u=e.paymentForm.get("amount"))==null?null:u.touched))),l(9),p("ngClass",S(10,L,((d=e.paymentForm.get("remark"))==null?null:d.invalid)&&(((d=e.paymentForm.get("remark"))==null?null:d.dirty)||((d=e.paymentForm.get("remark"))==null?null:d.touched)))),l(),p("ngIf",((h=e.paymentForm.get("remark"))==null?null:h.invalid)&&(((h=e.paymentForm.get("remark"))==null?null:h.dirty)||((h=e.paymentForm.get("remark"))==null?null:h.touched))),l(3),p("disabled",e.paymentForm.invalid),l(2),p("ngIf",e.paymentEntries.length>0)}},dependencies:[N,D,P,T,K,J,q,Y,U,G,M,$,z]});let a=m;return a})();export{pe as CreateReservationPaymentComponent};
