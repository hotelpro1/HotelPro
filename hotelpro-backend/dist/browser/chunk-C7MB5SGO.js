import{a as le,b as oe}from"./chunk-LIPDJV2Z.js";import{d as ne}from"./chunk-24LOKUE6.js";import{a as w}from"./chunk-MSXCR3QF.js";import{c as Y,d as c,e as Z,f as H,k as J,m as K,p as Q,q as W,r as X,s as ee,x as te,y as ie,z as re}from"./chunk-VIVXY5RX.js";import{b as B}from"./chunk-SWGOWEHE.js";import{Ba as N,Ca as S,Da as x,Db as L,Fb as j,Ib as G,Jb as F,L as M,La as T,Lb as $,Ma as r,Mb as z,Na as C,Pa as k,R as _,S as v,Xa as V,Ya as I,Za as y,a as b,b as A,ea as l,eb as D,fa as h,la as U,na as m,nb as P,ob as R,pb as q,wa as t,wb as O,xa as e,ya as g}from"./chunk-CWTEAQ4G.js";var me=s=>({selected:s}),ae=()=>({singleSelection:!1,idField:"_id",textField:"propertyUnitName",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:2,allowSearchFilter:!0}),E=s=>({"is-invalid":s});function ce(s,u){if(s&1){let o=N();t(0,"tr",23),S("click",function(){let n=_(o),d=n.$implicit,p=n.index,f=x();return v(f.selectUser(d,p))}),t(1,"td"),r(2),e(),t(3,"td"),r(4),e(),t(5,"td"),r(6),e(),t(7,"td"),r(8),e(),t(9,"td"),r(10),e(),t(11,"td"),r(12),e()()}if(s&2){let o=u.$implicit,i=u.index,n=x();m("ngClass",y(8,me,n.selectedUserIndex===i)),l(2),C(i+1),l(2),k("",o.firstName," ",o.lastName,""),l(2),C(o.phone),l(2),C(o.email),l(2),C(o.userType),l(2),C(o.isLoginable?"Active":"Deactive")}}function de(s,u){if(s&1&&(t(0,"tr")(1,"td"),r(2,"Property"),e(),t(3,"td"),g(4,"ng-multiselect-dropdown",24),e()()),s&2){let o=x();l(4),m("placeholder","Select Property")("settings",I(3,ae))("data",o.clientInfo.propertyUnits)}}function pe(s,u){s&1&&(t(0,"option",20),r(1," Manager "),e()),s&2&&m("value","manager")}function ue(s,u){if(s&1&&(t(0,"tr")(1,"td",30),r(2,"Property"),e(),t(3,"td"),g(4,"ng-multiselect-dropdown",24),e()()),s&2){let o=x(2);l(4),m("placeholder","Select Property")("settings",I(3,ae))("data",o.clientInfo.propertyUnits)}}function fe(s,u){if(s&1){let o=N();t(0,"div",25)(1,"h4",26),r(2,"Create user"),e(),t(3,"button",27),S("click",function(){let n=_(o).$implicit;return v(n.dismiss(!1))}),e()(),t(4,"form",28)(5,"table",29)(6,"tr")(7,"td",30)(8,"div"),r(9,"Category* :"),e()(),t(10,"td")(11,"select",31)(12,"option",20),r(13,"Frontdesk"),e(),U(14,pe,2,1,"option",32),e()()(),t(15,"tr")(16,"td",30)(17,"div"),r(18,"Name* :"),e()(),t(19,"td")(20,"div",33)(21,"div"),g(22,"input",34),e(),t(23,"div"),g(24,"input",35),e()()()(),t(25,"tr")(26,"td",30)(27,"div"),r(28,"Email* :"),e()(),t(29,"td"),g(30,"input",36),e()(),t(31,"tr")(32,"td",30)(33,"div"),r(34,"Contact Number* :"),e()(),t(35,"td"),g(36,"input",37),e()(),U(37,ue,5,4,"tr",21),t(38,"tr")(39,"td",30)(40,"div"),r(41,"Password* :"),e()(),t(42,"td"),g(43,"input",38),e()()(),t(44,"div",39)(45,"button",40),S("click",function(){let n=_(o).$implicit;return v(n.close("Close click"))}),r(46," CANCEL "),e(),t(47,"button",41),S("click",function(){_(o);let n=x();return v(n.addUser())}),r(48," Save "),e()()()}if(s&2){let o,i,n,d,p,f,a=x();l(4),m("formGroup",a.createUserForm),l(8),m("value","frontdesk"),l(2),m("ngIf",a.clientInfo.userType=="client"),l(8),m("ngClass",y(10,E,((o=a.createUserForm.get("firstName"))==null?null:o.invalid)&&(((o=a.createUserForm.get("firstName"))==null?null:o.dirty)||((o=a.createUserForm.get("firstName"))==null?null:o.touched)))),l(2),m("ngClass",y(12,E,((i=a.createUserForm.get("lastName"))==null?null:i.invalid)&&(((i=a.createUserForm.get("lastName"))==null?null:i.dirty)||((i=a.createUserForm.get("lastName"))==null?null:i.touched)))),l(6),m("ngClass",y(14,E,((n=a.createUserForm.get("email"))==null?null:n.invalid)&&(((n=a.createUserForm.get("email"))==null?null:n.dirty)||((n=a.createUserForm.get("email"))==null?null:n.touched)))),l(6),m("ngClass",y(16,E,(((d=a.createUserForm.get("phone"))==null?null:d.dirty)||((d=a.createUserForm.get("phone"))==null?null:d.touched))&&((d=a.createUserForm.get("phone"))==null?null:d.invalid))),l(),m("ngIf",((p=a.createUserForm.get("userType"))==null?null:p.value)=="manager"),l(6),m("ngClass",y(18,E,((f=a.createUserForm.get("password"))==null?null:f.invalid)&&(((f=a.createUserForm.get("password"))==null?null:f.dirty)||((f=a.createUserForm.get("password"))==null?null:f.touched)))),l(4),m("disabled",!a.createUserForm.valid)}}var Ae=(()=>{let u=class u{constructor(i,n,d,p,f,a,se){this.crudService=i,this.fb=n,this.alertService=d,this.activeRoute=p,this.router=f,this.modalService=a,this.authService=se,this.propertyUnitId="",this.userData=[],this.selectedUserIndex=0,this.selectedItems=[],this.dropdownSettings={}}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.clientInfo=this.authService.getUserInfo()?.user,this.initForms(),this.fetchData()}initForms(){this.userForm=this.fb.group({firstName:["",[c.required,w.noLeadingSpace,c.minLength(2)]],lastName:["",[c.required,w.noLeadingSpace,c.minLength(2)]],phone:["",[c.required]],email:["",[c.required,c.email]],active:[!0,[c.required]],userType:["frontdesk",[c.required]],propertyUnits:[]}),this.createUserForm=this.fb.group({propertyUnitId:[this.propertyUnitId],firstName:["",[c.required,c.pattern("^[a-zA-Z.'\\s]*$")]],lastName:["",[c.required,c.pattern("^[a-zA-Z.'\\s]*$")]],email:["",[c.required,c.email]],phone:["",[c.required]],userType:["frontdesk",[c.required]],password:["",[c.required,c.minLength(4)]],propertyUnits:[]})}fetchData(){this.crudService.post(F.READ_USER_BY_PROPERTY_UNIT,{propertyUnitId:this.propertyUnitId}).then(i=>{this.userData=i.data.users,this.userData?.length>0&&this.selectUser(this.userData[0],0)}).catch(i=>{this.alertService.errorAlert(i?.error?.message||"An error occurred while fetching users"),console.error(i)})}selectUser(i,n){this.selectedUserIndex=n;let d=[];i.userType=="manager"&&i?.accessPropertyUnitIds&&(d=this.clientInfo.propertyUnits.filter(p=>i.accessPropertyUnitIds.includes(p._id))),this.userForm.patchValue({firstName:i.firstName,lastName:i.lastName,phone:i.phone,email:i.email,active:i.isLoginable,userType:i.userType,propertyUnits:d})}updateUser(){if(this.userForm.valid){let i=A(b({},this.userForm.value),{userId:this.userData[this.selectedUserIndex]._id});this.crudService.post(F.UPDATE_USER,i).then(()=>{this.alertService.successAlert("User updated successfully"),this.ngOnInit()}).catch(n=>{this.alertService.errorAlert(n?.error?.message||"An error occurred while updating the user"),console.error(n)})}}addUser(){if(this.createUserForm.valid){let i=b({},this.createUserForm.value);this.crudService.post(F.CREATE_USER,i).then(()=>{this.alertService.successAlert("User created successfully"),this.ngOnInit()}).catch(n=>{this.alertService.errorAlert(n?.error?.message||"An error occurred while create the user")}).finally(()=>{this.modalService.dismissAll()})}}openModalAddUser(i){this.modalService.open(i,{centered:!0})}};u.\u0275fac=function(n){return new(n||u)(h($),h(te),h(z),h(L),h(j),h(ne),h(B))},u.\u0275cmp=M({type:u,selectors:[["app-manage-user"]],standalone:!0,features:[V],decls:67,vars:5,consts:[["AddUser",""],[1,"row","mt-4"],[1,"col-lg-8","col-md-8","col-sm-12"],[1,"card"],[1,"card-header","d-flex","justify-content-between"],[1,"align-content-center"],[1,"btn","btn-success","button",3,"click"],[1,"card-body"],[1,"table","text-center"],["scope","col"],["style","cursor: pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"col-lg-4","col-md-4","col-sm-12"],[1,"card-header"],[3,"formGroup"],[1,"table"],["type","text","formControlName","firstName",1,"form-control"],["type","text","formControlName","lastName",1,"form-control"],["type","text","formControlName","phone",1,"form-control"],["type","text","formControlName","email",1,"form-control"],["id","active","formControlName","active",1,"form-control"],[3,"value"],[4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"click"],[2,"cursor","pointer",3,"click","ngClass"],["name","roomtype","formControlName","propertyUnits",1,"multiselect_dropdown",3,"placeholder","settings","data"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"px-2","mt-2","fix_height",3,"formGroup"],[1,"table","table-sm","table-borderless","add_table"],[1,"custom_label"],["id","active","formControlName","userType",1,"form-control"],[3,"value",4,"ngIf"],[1,"d-flex","justify-content-between","p-0"],["type","text","formControlName","firstName","placeholder","First Name",1,"form-control","field",3,"ngClass"],["type","text","formControlName","lastName","placeholder","Last Name",1,"form-control","field",3,"ngClass"],["type","email","formControlName","email",1,"form-control","field",3,"ngClass"],["type","text","formControlName","phone",1,"form-control",3,"ngClass"],["formControlName","password",1,"form-control",3,"ngClass"],[1,"d-flex","justify-content-center","pb-3"],[1,"btn","light_button","button",3,"click"],[1,"btn","btn-success","button","ms-2",3,"click","disabled"]],template:function(n,d){if(n&1){let p=N();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),r(5,"Users"),e(),t(6,"div",6),S("click",function(){_(p);let a=T(66);return v(d.openModalAddUser(a))}),r(7," Create User "),e()(),t(8,"div",7)(9,"table",8)(10,"thead")(11,"tr")(12,"th",9),r(13,"No."),e(),t(14,"th",9),r(15,"Name"),e(),t(16,"th",9),r(17,"Mobile"),e(),t(18,"th",9),r(19,"Email"),e(),t(20,"th",9),r(21,"Type"),e(),t(22,"th",9),r(23,"Status"),e()()(),t(24,"tbody"),U(25,ce,13,10,"tr",10),e()()()()(),t(26,"div",11)(27,"div",3)(28,"div",12),r(29,"User Details"),e(),t(30,"div",7)(31,"form",13)(32,"table",14)(33,"tr")(34,"td"),r(35,"First Name"),e(),t(36,"td"),g(37,"input",15),e()(),t(38,"tr")(39,"td"),r(40,"Last Name"),e(),t(41,"td"),g(42,"input",16),e()(),t(43,"tr")(44,"td"),r(45,"Phone"),e(),t(46,"td"),g(47,"input",17),e()(),t(48,"tr")(49,"td"),r(50,"Email"),e(),t(51,"td"),g(52,"input",18),e()(),t(53,"tr")(54,"td"),r(55,"Status"),e(),t(56,"td")(57,"select",19)(58,"option",20),r(59,"Active"),e(),t(60,"option",20),r(61,"Deactive"),e()()()(),U(62,de,5,4,"tr",21),e(),t(63,"button",22),S("click",function(){return _(p),v(d.updateUser())}),r(64," Update User "),e()()()()()(),U(65,fe,49,20,"ng-template",null,0,D)}if(n&2){let p;l(25),m("ngForOf",d.userData),l(6),m("formGroup",d.userForm),l(27),m("value",!0),l(2),m("value",!1),l(2),m("ngIf",((p=d.userForm.get("userType"))==null?null:p.value)=="manager")}},dependencies:[O,P,R,q,ie,J,X,ee,Y,W,Z,H,re,K,Q,G,oe,le],styles:[".selected[_ngcontent-%COMP%]{background-color:#f0f8ff;font-weight:700}.add_table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{width:35%}"]});let s=u;return s})();export{Ae as ManageUserComponent};
