import{b as $,c as z,d as f,e as H,f as J,k as K,l as L,m as Q,n as W,o as X,p as Z,x as ee,y as te,z as oe}from"./chunk-HSWBAXOQ.js";import{Ca as N,Da as I,Ea as R,Eb as U,Gb as G,Kb as j,Lb as x,M as k,Na as u,Nb as Y,Ob as B,Pa as E,S as O,T as A,Ya as w,_a as T,fa as m,ga as b,ma as v,oa as p,ob as M,pb as q,qb as V,xa as a,xb as P,ya as n,za as _}from"./chunk-OZVGGEGK.js";var h=o=>({"is-invalid":o});function ne(o,d){o&1&&(a(0,"small",19),u(1,"Room Type Name is required"),n())}function le(o,d){o&1&&(a(0,"small",19),u(1,"Description is required"),n())}function re(o,d){o&1&&(a(0,"small",19),u(1,"Adult Occupancy is required"),n())}function ie(o,d){o&1&&(a(0,"small",19),u(1,"Child Occupancy is required"),n())}function me(o,d){o&1&&(a(0,"small",19),u(1,"Rate is required"),n())}function ae(o,d){if(o&1&&(a(0,"div",3)(1,"label",4),u(2,"Default Room Rate"),n(),_(3,"input",20),v(4,me,2,0,"small",6),n()),o&2){let r,e,l=R();m(3),p("ngClass",T(2,h,(((r=l.roomTypeForm.get("baseRate"))==null?null:r.dirty)||((r=l.roomTypeForm.get("baseRate"))==null?null:r.touched))&&((r=l.roomTypeForm.get("baseRate"))==null?null:r.invalid))),m(),p("ngIf",(((e=l.roomTypeForm.get("baseRate"))==null?null:e.dirty)||((e=l.roomTypeForm.get("baseRate"))==null?null:e.touched))&&((e=l.roomTypeForm.get("baseRate"))==null?null:e.invalid))}}function pe(o,d){o&1&&(a(0,"div",21),_(1,"input",22),a(2,"label",23),u(3,"Active"),n()())}function ue(o,d){o&1&&(a(0,"small",19),u(1,"Total Rooms is required"),n())}function se(o,d){if(o&1&&(a(0,"div",3)(1,"label",4),u(2,"Total Rooms"),n(),_(3,"input",24),v(4,ue,2,0,"small",6),n()),o&2){let r,e,l=R();m(3),p("ngClass",T(2,h,(((r=l.roomTypeForm.get("totalrooms"))==null?null:r.dirty)||((r=l.roomTypeForm.get("totalrooms"))==null?null:r.touched))&&((r=l.roomTypeForm.get("totalrooms"))==null?null:r.invalid))),m(),p("ngIf",(((e=l.roomTypeForm.get("totalrooms"))==null?null:e.dirty)||((e=l.roomTypeForm.get("totalrooms"))==null?null:e.touched))&&((e=l.roomTypeForm.get("totalrooms"))==null?null:e.invalid))}}function de(o,d){o&1&&(a(0,"div")(1,"p",25),u(2," Click below button to fill room details. "),n()())}function ce(o,d){o&1&&(a(0,"div")(1,"p",25),u(2," There are overlapping room ranges. "),n()())}function ye(o,d){o&1&&(a(0,"small",19),u(1,"Start is required"),n())}function ge(o,d){o&1&&(a(0,"small",19),u(1,"End is required"),n())}function ve(o,d){if(o&1&&(a(0,"span"),u(1),n()),o&2){let r,e=R().$implicit;m(),E("Allocated Rooms :",1+((r=e.get("end"))==null?null:r.value)-((r=e.get("start"))==null?null:r.value)," ")}}function _e(o,d){if(o&1){let r=N();a(0,"div",26)(1,"div",27)(2,"div",28)(3,"label",4),u(4,"Prefix"),n(),_(5,"input",29),n(),a(6,"div",28)(7,"label",4),u(8,"Start"),n(),_(9,"input",30),v(10,ye,2,0,"small",6),n(),a(11,"div",28)(12,"label",4),u(13,"End"),n(),_(14,"input",31),v(15,ge,2,0,"small",6),n(),a(16,"div",32),v(17,ve,2,1,"span",12),a(18,"i",33),I("click",function(){let l=O(r).index,t=R();return A(t.removeRoom(l))}),u(19," delete "),n()()()()}if(o&2){let r,e,l,t,s,i=d.$implicit,c=d.index;m(),p("formGroupName",c),m(8),p("ngClass",T(6,h,(((r=i.get("start"))==null?null:r.dirty)||((r=i.get("start"))==null?null:r.touched))&&((r=i.get("start"))==null?null:r.invalid))),m(),p("ngIf",(((e=i.get("start"))==null?null:e.dirty)||((e=i.get("start"))==null?null:e.touched))&&((e=i.get("start"))==null?null:e.invalid)),m(4),p("ngClass",T(8,h,(((l=i.get("end"))==null?null:l.dirty)||((l=i.get("end"))==null?null:l.touched))&&((l=i.get("end"))==null?null:l.invalid))),m(),p("ngIf",(((t=i.get("end"))==null?null:t.dirty)||((t=i.get("end"))==null?null:t.touched))&&((t=i.get("end"))==null?null:t.invalid)),m(2),p("ngIf",((s=i.get("end"))==null?null:s.value)!=0&&((s=i.get("start"))==null?null:s.value)!=0&&((s=i.get("end"))==null?null:s.value)-((s=i.get("start"))==null?null:s.value)>=0)}}function fe(o,d){if(o&1){let r=N();a(0,"div",34)(1,"div",35)(2,"button",36),I("click",function(){O(r);let l=R();return A(l.addRoom())}),a(3,"i",37),u(4," add "),n(),u(5," Add Room "),n()()()}}function Te(o,d){if(o&1&&(a(0,"span"),u(1),n()),o&2){let r,e=R();m(),E("Remaining Rooms ",((r=e.roomTypeForm.get("totalrooms"))==null?null:r.value)-e.roomCount," ")}}var Ae=(()=>{let d=class d{constructor(e,l,t,s,i){this.crudService=e,this.fb=l,this.alertService=t,this.activeRoute=s,this.router=i,this.propertyUnitId="",this.roomTypeId="ADD",this.roomCount=0}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.roomTypeId=this.activeRoute.snapshot.paramMap.get("roomTypeId"),this.roomTypeForm=this.fb.group({roomTypeName:["",f.required],active:[!0],description:[""],adultOccupancy:[0,[f.min(1),f.required]],childOccupancy:[0,[f.min(0),f.required]],baseRate:[0],rooms:this.fb.array([])},{validators:[this.totalRoomsValidator(),this.noOverlappingRanges()]}),this.roomTypeId&&this.roomTypeId!="ADD"?this.crudService.post(x.READ_ROOMTYPE_BY_ID+this.roomTypeId).then(e=>{console.log(e),this.roomTypeForm.reset(e.data)}).catch(e=>{this.alertService.errorAlert(e.message),this.router.navigate(["/roomtype-setup/"+this.propertyUnitId+"/ADD"]),this.ngOnInit()}):this.roomTypeForm.addControl("totalrooms",this.fb.control(0,[f.min(1),f.required]))}get rooms(){return this.roomTypeForm.get("rooms")}createRoomGroup(e){return this.fb.group({prefix:[e?.prefix||""],start:[e?.start||0,f.required],end:[e?.end||0,f.required]})}addRoom(e){this.rooms.push(this.createRoomGroup(e))}onSubmit(){this.roomTypeForm.valid?(console.log(this.roomTypeForm.value),this.roomTypeId=="ADD"?this.crudService.post(x.CREATE_ROOMTYPE_AND_ROOMS+this.propertyUnitId,this.roomTypeForm.value).then(e=>{console.log(e),this.alertService.successAlert(e.message),this.navigateToRoomReview()}).catch(e=>{this.alertService.errorAlert(e.message)}):this.crudService.post(x.UPDATE_ROOM_TYPE+this.roomTypeId,this.roomTypeForm.value).then(e=>{console.log(e),this.alertService.successAlert(e.message),this.navigateToRoomReview()}).catch(e=>{this.alertService.errorAlert(e.message)})):this.roomTypeForm.markAllAsTouched()}removeRoom(e){this.rooms.removeAt(e)}totalRoomsValidator(){return e=>{let l=e.get("totalrooms")?.value,t=e.get("rooms");if(!l||!t)return null;let s=0;return t.controls.forEach(i=>{let c=parseInt(i.get("start")?.value,10),y=parseInt(i.get("end")?.value,10);c&&y&&(s+=y-c+1)}),this.roomCount=s,s===l?null:{totalRoomsMismatch:!0}}}noOverlappingRanges(){return e=>{let l=e.get("rooms");if(!l)return null;let t=[],s=!1;return l.controls.forEach(i=>{let c=parseInt(i.get("start")?.value,10),y=parseInt(i.get("end")?.value,10);if(c&&y){for(let g of t)if(c>=g.start&&c<=g.end||y>=g.start&&y<=g.end||c<=g.start&&y>=g.end){s=!0;break}t.push({start:c,end:y})}}),s?{overlappingRanges:!0}:null}}navigateToRoomReview(){this.router.navigate(["/rooms-review",this.propertyUnitId])}};d.\u0275fac=function(l){return new(l||d)(b(Y),b(ee),b(B),b(U),b(G))},d.\u0275cmp=k({type:d,selectors:[["app-room-type-range-setup"]],standalone:!0,features:[w],decls:38,vars:26,consts:[[1,"container","container_form","my-3","rounded"],[3,"formGroup"],[1,"row","row-cols-1","row-cols-md-2"],[1,"col","mt-3"],[1,"form-label"],["type","text","formControlName","roomTypeName","placeholder","Enter Room Type Name",1,"form-control",3,"ngClass"],["class","text-danger",4,"ngIf"],["type","text","formControlName","description","placeholder","Enter Description",1,"form-control",3,"ngClass"],["type","number","formControlName","adultOccupancy",1,"form-control",3,"ngClass"],["type","number","formControlName","childOccupancy",1,"form-control",3,"ngClass"],["class","col mt-3",4,"ngIf"],["class","col mt-3 ms-3 form-check",4,"ngIf"],[4,"ngIf"],["formArrayName","rooms","class","mt-4 border-top",4,"ngFor","ngForOf"],["class","row mt-3",4,"ngIf"],[1,"col-md-12","mt-4"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-secondary","mb-3",3,"click"],["type","button",1,"btn","btn-primary","mb-3","ms-2",3,"click"],[1,"text-danger"],["type","number","formControlName","baseRate",1,"form-control",3,"ngClass"],[1,"col","mt-3","ms-3","form-check"],["type","checkbox","formControlName","active",1,"form-check-input"],[1,"form-check-label"],["type","number","formControlName","totalrooms",1,"form-control",3,"ngClass"],[1,"text-danger","mt-2"],["formArrayName","rooms",1,"mt-4","border-top"],[1,"row","mt-3",3,"formGroupName"],[1,"col-md-2","mt-2"],["type","text","formControlName","prefix","placeholder","Prefix",1,"form-control"],["type","number","formControlName","start","placeholder","Start",1,"form-control",3,"ngClass"],["type","number","formControlName","end","placeholder","End",1,"form-control",3,"ngClass"],[1,"col-md-2","mt-4","pt-3"],[1,"material-symbols-rounded","text-danger",3,"click"],[1,"row","mt-3"],[1,"col-md-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"material-symbols-rounded"]],template:function(l,t){if(l&1&&(a(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"label",4),u(5,"Room Type Name*"),n(),_(6,"input",5),v(7,ne,2,0,"small",6),n(),a(8,"div",3)(9,"label",4),u(10,"Description"),n(),_(11,"input",7),v(12,le,2,0,"small",6),n(),a(13,"div",3)(14,"label",4),u(15,"Adult Occupancy*"),n(),_(16,"input",8),v(17,re,2,0,"small",6),n(),a(18,"div",3)(19,"label",4),u(20,"Child Occupancy"),n(),_(21,"input",9),v(22,ie,2,0,"small",6),n(),v(23,ae,5,4,"div",10)(24,pe,4,0,"div",11)(25,se,5,4,"div",10),n(),v(26,de,3,0,"div",12)(27,ce,3,0,"div",12)(28,_e,20,10,"div",13)(29,fe,6,0,"div",14),a(30,"div"),v(31,Te,2,1,"span",12),n(),a(32,"div",15)(33,"div",16)(34,"button",17),I("click",function(){return t.navigateToRoomReview()}),u(35," Cancel "),n(),a(36,"button",18),I("click",function(){return t.onSubmit()}),u(37),n()()()()()),l&2){let s,i,c,y,g,C,F,S,D;m(),p("formGroup",t.roomTypeForm),m(5),p("ngClass",T(18,h,(((s=t.roomTypeForm.get("roomTypeName"))==null?null:s.dirty)||((s=t.roomTypeForm.get("roomTypeName"))==null?null:s.touched))&&((s=t.roomTypeForm.get("roomTypeName"))==null?null:s.invalid))),m(),p("ngIf",(((i=t.roomTypeForm.get("roomTypeName"))==null?null:i.dirty)||((i=t.roomTypeForm.get("roomTypeName"))==null?null:i.touched))&&((i=t.roomTypeForm.get("roomTypeName"))==null?null:i.invalid)),m(4),p("ngClass",T(20,h,(((c=t.roomTypeForm.get("description"))==null?null:c.dirty)||((c=t.roomTypeForm.get("description"))==null?null:c.touched))&&((c=t.roomTypeForm.get("description"))==null?null:c.invalid))),m(),p("ngIf",(((y=t.roomTypeForm.get("description"))==null?null:y.dirty)||((y=t.roomTypeForm.get("description"))==null?null:y.touched))&&((y=t.roomTypeForm.get("description"))==null?null:y.invalid)),m(4),p("ngClass",T(22,h,(((g=t.roomTypeForm.get("adultOccupancy"))==null?null:g.dirty)||((g=t.roomTypeForm.get("adultOccupancy"))==null?null:g.touched))&&((g=t.roomTypeForm.get("adultOccupancy"))==null?null:g.invalid))),m(),p("ngIf",(((C=t.roomTypeForm.get("adultOccupancy"))==null?null:C.dirty)||((C=t.roomTypeForm.get("adultOccupancy"))==null?null:C.touched))&&((C=t.roomTypeForm.get("adultOccupancy"))==null?null:C.invalid)),m(4),p("ngClass",T(24,h,(((F=t.roomTypeForm.get("childOccupancy"))==null?null:F.dirty)||((F=t.roomTypeForm.get("childOccupancy"))==null?null:F.touched))&&((F=t.roomTypeForm.get("childOccupancy"))==null?null:F.invalid))),m(),p("ngIf",(((S=t.roomTypeForm.get("childOccupancy"))==null?null:S.dirty)||((S=t.roomTypeForm.get("childOccupancy"))==null?null:S.touched))&&((S=t.roomTypeForm.get("childOccupancy"))==null?null:S.invalid)),m(),p("ngIf",t.roomTypeId=="ADD"),m(),p("ngIf",t.roomTypeId!="ADD"),m(),p("ngIf",t.roomTypeId=="ADD"),m(),p("ngIf",t.roomTypeForm.errors==null?null:t.roomTypeForm.errors.totalRoomsMismatch),m(),p("ngIf",t.roomTypeForm.errors==null?null:t.roomTypeForm.errors.overlappingRanges),m(),p("ngForOf",t.rooms.controls),m(),p("ngIf",t.roomTypeId=="ADD"),m(2),p("ngIf",(D=t.roomTypeForm.get("totalrooms"))==null?null:D.value),m(6),E(" ",t.roomTypeId!="ADD"?"Update":"Add"," ")}},dependencies:[P,M,q,V,te,K,z,L,$,H,J,oe,Q,Z,W,X,j],styles:[".form-label[_ngcontent-%COMP%]{margin-bottom:0}.form-control.is-invalid[_ngcontent-%COMP%]{background-image:none;padding-right:.375rem .75rem}.container_form[_ngcontent-%COMP%]{background:#00000023}"]});let o=d;return o})();export{Ae as RoomTypeRangeSetupComponent};
