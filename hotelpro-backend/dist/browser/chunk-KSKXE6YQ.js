import{a as Ce,b as xe}from"./chunk-MSM33I7I.js";import{d as _e}from"./chunk-6N4QSK7X.js";import{c as ie,d as E,e as le,f as re,j as ne,k as oe,l as ae,m as se,p as ue,q as de,r as me,s as ce,x as pe,y as ge,z as he}from"./chunk-DKI4PBNW.js";import{b as te}from"./chunk-3FS5RTN6.js";import{Aa as q,Ba as I,Ca as C,Da as h,Db as Q,Fb as X,Jb as Y,Kb as Z,L as P,La as B,Ma as o,Mb as $,Na as w,Nb as ee,Oa as G,Pa as M,R as p,S as g,Ta as R,Ua as T,Va as k,Xa as j,Za as b,a as N,b as W,ea as u,eb as U,fa as v,la as f,na as c,nb as L,ob as J,pb as z,tb as H,wa as r,wb as K,xa as l,ya as A,za as O}from"./chunk-W7CJDNGE.js";var V=s=>({"is-invalid":s});function ve(s,m){s&1&&(r(0,"small",15),o(1," Arrival is required "),l())}function fe(s,m){s&1&&(r(0,"small",15),o(1," Departure is required "),l())}function Se(s,m){s&1&&(r(0,"small",15),o(1," Adults is required "),l())}function ye(s,m){s&1&&(r(0,"small",15),o(1," Children is required "),l())}function Fe(s,m){if(s&1){let n=I();r(0,"tr")(1,"td"),o(2),l(),r(3,"td"),o(4),l(),r(5,"td"),o(6),r(7,"span",19),C("click",function(){let e=p(n).$implicit,t=h(2),a=B(29);return g(t.openExtraModal(a,e))}),o(8),l()(),r(9,"td"),o(10),l(),r(11,"td"),o(12),l(),r(13,"td")(14,"ng-multiselect-dropdown",20),k("ngModelChange",function(e){let t=p(n).index,a=h(2);return T(a.selectedItems[t],e)||(a.selectedItems[t]=e),g(e)}),C("onSelect",function(e){let t=p(n).index,a=h(2);return g(a.onItemSelect(e,t))})("onDeSelect",function(e){let t=p(n).index,a=h(2);return g(a.onItemDeSelect(e,t))}),l()()()}if(s&2){let n=m.$implicit,i=m.index,e=h(2);u(2),M("",n.roomtype," ",n.rateName,""),u(2),w(n.totalRoom),u(2),M(" ",n.adultOccupant," Adults ",n.childOccupant," Childs "),u(2),G(" ",n.extraAdults==0&&n.extraChilds==0?"add":"("+n.extraAdults+"/"+n.extraChilds+")"," "),u(2),w(n==null||n.roomPrice==null?null:n.roomPrice.toFixed(2)),u(2),w(n==null||n.roomCost==null?null:n.roomCost.toFixed(2)),u(2),c("placeholder","Select Room")("settings",n.dropdownSettings)("data",e.dropDownData(n.rooms,i)),R("ngModel",e.selectedItems[i])}}function De(s,m){if(s&1&&(r(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),o(5,"Room Type Name"),l(),r(6,"th"),o(7,"Available Rooms"),l(),r(8,"th"),o(9,"Sleeps"),l(),r(10,"th"),o(11,"Rate"),l(),r(12,"th"),o(13,"Cost"),l(),r(14,"th"),o(15,"Room"),l()()(),r(16,"tbody"),f(17,Fe,15,12,"tr",18),l()()()),s&2){let n=h();u(17),c("ngForOf",n.roomsData)("ngForTrackBy",n.trackByFn)}}function we(s,m){if(s&1&&(O(0),o(1),q()),s&2){let n,i=h(2);u(),G(" (Total Cost ",(n=i.groupForm.get("totalCost"))==null||n.value==null?null:n.value.toFixed(2),") ")}}function Ee(s,m){if(s&1){let n=I();r(0,"div",21)(1,"button",22),C("click",function(){p(n);let e=h();return g(e.onSubmit())}),o(2," Next "),f(3,we,2,1,"ng-container",23),l()()}if(s&2){let n,i,e=h();u(),c("disabled",(e.totalGuests==null?null:e.totalGuests.adults)+(e.totalGuests==null?null:e.totalGuests.childs)<((n=e.groupForm.get("adults"))==null?null:n.value)+((n=e.groupForm.get("childs"))==null?null:n.value)),u(2),c("ngIf",(e.totalGuests==null?null:e.totalGuests.adults)+(e.totalGuests==null?null:e.totalGuests.childs)>=((i=e.groupForm.get("adults"))==null?null:i.value)+((i=e.groupForm.get("childs"))==null?null:i.value))}}function Ie(s,m){if(s&1){let n=I();r(0,"div",24)(1,"h4",25),o(2,"Add Adults/Children"),l(),r(3,"button",26),C("click",function(){let e=p(n).$implicit;return g(e.dismiss(!1))}),l()(),r(4,"div",27)(5,"table",17)(6,"thead")(7,"tr")(8,"th",28),o(9,"Guests"),l(),r(10,"th",28),o(11,"Rate"),l(),r(12,"th"),o(13,"Number of Extras"),l()()(),r(14,"tbody")(15,"tr")(16,"th",29),o(17,"Adults"),l(),r(18,"td"),o(19),l(),r(20,"td")(21,"select",30),k("ngModelChange",function(e){p(n);let t=h();return T(t.extraGuestsData.extraAdults,e)||(t.extraGuestsData.extraAdults=e),g(e)}),r(22,"option",31),o(23,"0"),l(),r(24,"option",32),o(25,"1"),l(),r(26,"option",33),o(27,"2"),l(),r(28,"option",34),o(29,"3"),l()()()(),r(30,"tr")(31,"th",29),o(32,"Children"),l(),r(33,"td"),o(34),l(),r(35,"td")(36,"select",30),k("ngModelChange",function(e){p(n);let t=h();return T(t.extraGuestsData.extraChilds,e)||(t.extraGuestsData.extraChilds=e),g(e)}),r(37,"option",31),o(38,"0"),l(),r(39,"option",32),o(40,"1"),l(),r(41,"option",33),o(42,"2"),l(),r(43,"option",34),o(44,"3"),l()()()()()()(),r(45,"div",35)(46,"button",36),C("click",function(){let e=p(n).$implicit;return g(e.close(!0))}),o(47," Save "),l()()}if(s&2){let n=h();u(19),w(n.extraGuestsData.adultRate),u(2),R("ngModel",n.extraGuestsData.extraAdults),u(13),w(n.extraGuestsData.childRate),u(2),R("ngModel",n.extraGuestsData.extraChilds)}}var je=(()=>{let m=class m{constructor(i,e,t,a,d,_,x){this.fb=i,this.crudService=e,this.alertService=t,this.authService=a,this.route=d,this.router=_,this.modalService=x,this.roomsData=[],this.selectedItems=[],this.totalGuests={adults:0,childs:0},this.propertyUnitId="",this.roomTypeRooms={},this.extraGuestsData={extraAdults:0,extraChilds:0,childRate:0,adultRate:0},this.Today=""}ngOnInit(){this.propertyUnitId=this.authService.getUserInfo()?.user?.propertyUnitId,this.initForms(),this.clearSession()}clearSession(){sessionStorage.removeItem("reservationsArray"),sessionStorage.removeItem("groupDetails"),sessionStorage.removeItem("resdata")}initForms(){let i=new Date,e=this.formatDate(i);this.Today=e;let t=this.formatDate(new Date(i.getTime()+1*24*60*60*1e3));this.groupForm=this.fb.group({arrival:[e,E.required],departure:[t,E.required],adults:[2,[E.min(1),E.required]],childs:[0,E.required],totalCost:[0],totalPrice:[0]})}nextDate(){let i=new Date(this.groupForm.get("arrival")?.value);return i.setDate(i.getDate()+1),this.formatDate(i)}setDeparture(){let i=new Date(this.groupForm.get("arrival")?.value),e=new Date(this.groupForm.get("departure")?.value);if(i>=e){let t=(e.getTime()-i.getTime())/864e5;t=t<1?1:Math.round(t),i.setDate(i.getDate()+t),this.groupForm.controls.departure.setValue(this.formatDate(i))}this.resetGuestTotals()}formatDate(i){return new H("en-US").transform(i,"yyyy-MM-dd")||""}readRooms(){this.resetGuestTotals(),this.crudService.post(Z.READ_RESERVATION_RATE+this.propertyUnitId,this.groupForm.value).then(i=>{this.processRoomsData(i.data)}).catch(i=>{this.alertService.errorAlert(i?.error?.message)})}resetGuestTotals(){this.roomsData=[],this.selectedItems=[],this.roomTypeRooms={},this.totalGuests={adults:0,childs:0},this.groupForm.patchValue({totalCost:0,totalPrice:0})}processRoomsData(i){this.roomsData=i.map(e=>(e.dropdownSettings={singleSelection:!1,idField:"id",textField:"roomName",unSelectAllText:"UnSelect All",enableCheckAll:!1,itemsShowLimit:3,allowSearchFilter:!0},e.extraAdults=0,e.extraChilds=0,[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.roomTypeRooms[e.roomTypeId]||(this.roomTypeRooms[e.roomTypeId]=e.rooms),this.selectedItems.push([]),e))}calculateRoomCost(i){let e=i.dateRate.reduce((a,d)=>a+Number(d.baseRate)+Number(d.adultRate*i.extraAdults)+Number(d.childRate*i.extraChilds),0),t=e*i.taxPercentage/100;return[e,e+t]}updateRoomSelection(i,e){let t=this.roomsData[i];this.roomsData.forEach((a,d)=>{a.roomTypeId===t.roomTypeId&&(a.totalRoom-=e)}),this.totalGuests.adults+=e*t.adultOccupant,this.totalGuests.childs+=e*t.childOccupant,this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value+e*t.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value+e*t.roomPrice)}onItemDeSelect(i,e){this.updateRoomSelection(e,-1)}onItemSelect(i,e){this.updateRoomSelection(e,1)}trackByFn(i,e){return e.id}dropDownData(i,e){return i.filter(t=>!this.selectedItems.some((a,d)=>d!==e&&a.some(_=>_.id===t.id)))}onSubmit(){let i=this.prepareReservationDetails();sessionStorage.setItem("resdata",JSON.stringify({reservationDetails:i,groupDetails:this.groupForm.value,roomTypeRooms:this.roomTypeRooms})),this.router.navigate(["/walkin-info"])}prepareReservationDetails(){return this.roomsData.reduce((i,e,t)=>{let a=this.createRoomDetails(e,t);return i.concat(a)},[])}createRoomDetails(i,e){return this.selectedItems[e].map(a=>W(N({},i),{room:i,roomId:a.id}))}openExtraModal(i,e){this.extraGuestsData={extraAdults:e.extraAdults,extraChilds:e.extraChilds,childRate:e.dateRate[0].childRate,adultRate:e.dateRate[0].adultRate},this.modalService.open(i).result.then(t=>{t&&(this.totalGuests.adults-=e.adultOccupant+e.extraAdults,this.totalGuests.childs-=e.childOccupant+e.extraChilds,e.extraAdults=Number(this.extraGuestsData.extraAdults),e.extraChilds=Number(this.extraGuestsData.extraChilds),this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value-e.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value-e.roomPrice),[e.roomPrice,e.roomCost]=this.calculateRoomCost(e),this.totalGuests.adults+=e.adultOccupant+e.extraAdults,this.totalGuests.childs+=e.childOccupant+e.extraChilds,this.groupForm.controls.totalCost.patchValue(this.groupForm.get("totalCost")?.value+e.roomCost),this.groupForm.controls.totalPrice.patchValue(this.groupForm.get("totalPrice")?.value+e.roomPrice))})}};m.\u0275fac=function(e){return new(e||m)(v(pe),v($),v(ee),v(te),v(Q),v(X),v(_e))},m.\u0275cmp=P({type:m,selectors:[["app-create-walkin"]],standalone:!0,features:[j],decls:30,vars:22,consts:[["extraGuests",""],[1,"container","container_form","my-3","rounded"],[3,"formGroup"],[1,"row","row-cols-1","row-cols-md-2"],[1,"col","mt-3"],[1,"form-label"],["type","date","formControlName","arrival","placeholder","Enter arrival","readonly","",1,"form-control",3,"input","min","ngClass"],["class","text-danger",4,"ngIf"],["type","date","formControlName","departure","placeholder","Enter departure",1,"form-control",3,"input","min","ngClass"],["type","number","formControlName","adults","placeholder","Enter adults",1,"form-control",3,"ngClass"],["type","number","formControlName","childs","placeholder","Enter children",1,"form-control",3,"ngClass"],[1,"col","my-3"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","container-fluid text-center",4,"ngIf"],["class","container text-center",4,"ngIf"],[1,"text-danger"],[1,"container-fluid","text-center"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"link","text-primary",3,"click"],["name","roomtype",1,"multiselect_dropdown",3,"ngModelChange","onSelect","onDeSelect","placeholder","settings","data","ngModel"],[1,"container","text-center"],[1,"btn","btn-primary","my-3",3,"click","disabled"],[4,"ngIf"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["scope","col"],["scope","row"],[1,"form-control","text-center","select_reason",3,"ngModelChange","ngModel"],["value","0"],["value","1"],["value","2"],["value","3"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"]],template:function(e,t){if(e&1){let a=I();r(0,"div",1)(1,"form",2)(2,"div",3)(3,"div",4)(4,"label",5),o(5,"CheckIn Date"),l(),r(6,"input",6),C("input",function(){return p(a),g(t.setDeparture())}),l(),f(7,ve,2,0,"small",7),l(),r(8,"div",4)(9,"label",5),o(10,"Checkout Date"),l(),r(11,"input",8),C("input",function(){return p(a),g(t.resetGuestTotals())}),l(),f(12,fe,2,0,"small",7),l(),r(13,"div",4)(14,"label",5),o(15,"Adults"),l(),A(16,"input",9),f(17,Se,2,0,"small",7),l(),r(18,"div",4)(19,"label",5),o(20,"Children"),l(),A(21,"input",10),f(22,ye,2,0,"small",7),l(),r(23,"div",11)(24,"button",12),C("click",function(){return p(a),g(t.readRooms())}),o(25," Show Availability "),l()()()()(),f(26,De,18,2,"div",13)(27,Ee,4,2,"div",14)(28,Ie,48,4,"ng-template",null,0,U)}if(e&2){let a,d,_,x,S,y,F,D;u(),c("formGroup",t.groupForm),u(5),c("min",t.Today)("ngClass",b(14,V,((a=t.groupForm.get("arrival"))==null?null:a.invalid)&&(((a=t.groupForm.get("arrival"))==null?null:a.dirty)||((a=t.groupForm.get("arrival"))==null?null:a.touched)))),u(),c("ngIf",((d=t.groupForm.get("arrival"))==null?null:d.invalid)&&(((d=t.groupForm.get("arrival"))==null?null:d.dirty)||((d=t.groupForm.get("arrival"))==null?null:d.touched))),u(4),c("min",t.nextDate())("ngClass",b(16,V,((_=t.groupForm.get("departure"))==null?null:_.invalid)&&(((_=t.groupForm.get("departure"))==null?null:_.dirty)||((_=t.groupForm.get("departure"))==null?null:_.touched)))),u(),c("ngIf",((x=t.groupForm.get("departure"))==null?null:x.invalid)&&(((x=t.groupForm.get("departure"))==null?null:x.dirty)||((x=t.groupForm.get("departure"))==null?null:x.touched))),u(4),c("ngClass",b(18,V,((S=t.groupForm.get("adults"))==null?null:S.invalid)&&(((S=t.groupForm.get("adults"))==null?null:S.dirty)||((S=t.groupForm.get("adults"))==null?null:S.touched)))),u(),c("ngIf",((y=t.groupForm.get("adults"))==null?null:y.invalid)&&(((y=t.groupForm.get("adults"))==null?null:y.dirty)||((y=t.groupForm.get("adults"))==null?null:y.touched))),u(4),c("ngClass",b(20,V,((F=t.groupForm.get("childs"))==null?null:F.invalid)&&(((F=t.groupForm.get("childs"))==null?null:F.dirty)||((F=t.groupForm.get("childs"))==null?null:F.touched)))),u(),c("ngIf",((D=t.groupForm.get("childs"))==null?null:D.invalid)&&(((D=t.groupForm.get("childs"))==null?null:D.dirty)||((D=t.groupForm.get("childs"))==null?null:D.touched))),u(2),c("disabled",t.groupForm.invalid),u(2),c("ngIf",t.roomsData.length>0),u(),c("ngIf",t.roomsData.length>0)}},dependencies:[K,L,J,z,ge,oe,me,ce,ie,ae,de,le,re,ne,he,se,ue,Y,xe,Ce]});let s=m;return s})();export{je as CreateWalkinComponent};
