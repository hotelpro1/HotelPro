import{c as G,d as u,e as $,f as L,m as P,n as Y,o as z,p as H,x as J,y as K,z as Q}from"./chunk-VIVXY5RX.js";import{Aa as N,Ba as R,Ca as b,Da as p,Db as D,Fb as M,Gb as q,Ib as j,Jb as T,L as w,Lb as B,Ma as l,Mb as U,Oa as C,Pa as k,R as v,S as x,Xa as A,ea as s,fa as h,la as y,na as d,ob as F,pb as O,qa as S,wa as m,wb as V,xa as r,ya as I,za as E}from"./chunk-CWTEAQ4G.js";function W(n,c){n&1&&(m(0,"th",5),l(1,"Action"),r())}function X(n,c){n&1&&(m(0,"small",26),l(1," Room Name is required "),r())}function Z(n,c){n&1&&(m(0,"small",26),l(1," Room Number is required "),r())}function ee(n,c){if(n&1){let a=R();m(0,"button",30),b("click",function(){v(a);let t=p(2).$implicit;return x(t.disabled?t.enable():t.disable())}),l(1," Edit "),r()}}function te(n,c){if(n&1){let a=R();m(0,"button",31),b("click",function(){v(a);let t=p(2),o=t.$implicit,i=t.index,_=p(3).index,f=p();return x(f.editRoom(_,i,o.value))}),l(1," Save "),r()}if(n&2){let a=p(2).$implicit;d("disabled",a.invalid)}}function oe(n,c){if(n&1){let a=R();m(0,"button",32),b("click",function(){v(a);let t=p(2).index,o=p(3).index,i=p();return x(i.deleteRoom(o,t))}),l(1," Delete "),r()}}function ie(n,c){if(n&1&&(m(0,"td")(1,"div"),y(2,ee,2,0,"button",27)(3,te,2,1,"button",28)(4,oe,2,0,"button",29),r()()),n&2){let a=p().$implicit;s(2),d("ngIf",a.disabled),s(),d("ngIf",!a.disabled),s(),d("ngIf",!a.disabled)}}function ne(n,c){if(n&1&&(m(0,"tr",11)(1,"th",22),l(2),r(),m(3,"td"),I(4,"input",23),y(5,X,2,0,"small",24),r(),m(6,"td"),I(7,"input",25),y(8,Z,2,0,"small",24),r(),y(9,ie,5,3,"td",16),r()),n&2){let a,e,t=c.$implicit,o=c.index,i=p(4);d("formGroupName",o),s(2),C(" ",o+1," "),s(3),d("ngIf",(((a=t.get("roomName"))==null?null:a.dirty)||((a=t.get("roomName"))==null?null:a.touched))&&((a=t.get("roomName"))==null?null:a.invalid)),s(3),d("ngIf",(((e=t.get("roomNumber"))==null?null:e.dirty)||((e=t.get("roomNumber"))==null?null:e.touched))&&((e=t.get("roomNumber"))==null?null:e.invalid)),s(),d("ngIf",i.showActionBtn)}}function re(n,c){if(n&1&&(m(0,"table",19)(1,"thead")(2,"tr")(3,"th",5),l(4,"Sr No."),r(),m(5,"th",5),l(6,"Room Name"),r(),m(7,"th",5),l(8,"Room Number"),r(),y(9,W,2,0,"th",20),r()(),m(10,"tbody",21),y(11,ne,10,5,"tr",7),r()()),n&2){let a=c.ngIf,e=p(3);s(9),d("ngIf",e.showActionBtn),s(2),d("ngForOf",a.controls)("ngForTrackBy",e.trackByFn)}}function me(n,c){if(n&1&&(m(0,"tr")(1,"td",17),y(2,re,12,3,"table",18),r()()),n&2){let a=p().index,e=p();s(2),d("ngIf",e.getRooms(a))}}function ae(n,c){if(n&1){let a=R();E(0,11),m(1,"tr")(2,"td")(3,"a",12),l(4),r()(),m(5,"td")(6,"div",13),l(7),r()(),m(8,"td")(9,"div",13),l(10),r()(),m(11,"td")(12,"button",14),b("click",function(){let t,o=v(a),i=o.$implicit,_=o.index,f=p();return x(f.addRoom(_,{roomTypeId:(t=i.get("roomTypeId"))==null?null:t.value}))}),l(13," Add Room "),r(),m(14,"i",15),b("click",function(){let t=v(a).index,o=p();return x(o.toggleRow(t))}),l(15," arrow_forward_ios "),r()()(),y(16,me,3,1,"tr",16),N()}if(n&2){let a,e,t,o,i=c.$implicit,_=c.index,f=p();d("formGroupName",_),s(3),d("routerLink","/roomtype-setup/"+f.propertyUnitId+"/"+((a=i.get("roomTypeId"))==null?null:a.value)),s(),C(" ",(e=i.get("roomTypeName"))==null?null:e.value," "),s(3),k(" Adults- ",(t=i.get("adultOccupancy"))==null?null:t.value,",Childs-",(t=i.get("childOccupancy"))==null?null:t.value," "),s(3),C(" ",(o=i.get("active"))!=null&&o.value?"Active":"Deactive"," "),s(4),S(f.isRowExpanded(_)?"    rotate: 270deg;":"    rotate: 90deg;"),s(2),d("ngIf",f.isRowExpanded(_))}}var be=(()=>{let c=class c{constructor(e,t,o,i,_){this.crudService=e,this.fb=t,this.alertService=o,this.activeRoute=i,this.router=_,this.columnArray=[],this.showActionBtn=!0,this.filterData=[],this.searchbox="",this.propertyUnitId="",this.expandedRowIndices=new Set}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.roomTypesForm=this.fb.group({roomTypes:this.fb.array([])}),this.loadRoomTypes()}loadRoomTypes(){this.crudService.post(T.READ_ROOMTYPE_AND_ROOMS+this.propertyUnitId).then(e=>{let t=this.roomSort(e.data);for(let o of t)this.addRoomType(o)}).catch(e=>{this.alertService.errorAlert(e?.error?.message),console.log(e)})}createRoom(e){let t=this.fb.group({roomName:[e?.roomName||"",[u.required]],roomNumber:[e?.roomNumber||"",[u.required,u.pattern("^[0-9]*$")]],roomId:[e?.roomId||""],roomTypeId:[e?.roomTypeId||"",u.required]});return e?.roomId&&t.disable(),t}addRoom(e,t){this.expandedRowIndices.add(e),this.getRooms(e).push(this.createRoom(t))}get roomTypes(){return this.roomTypesForm.get("roomTypes")}createRoomType(e={}){let t=this.fb.group({roomTypeId:[e.roomTypeId||"",u.required],roomTypeName:[e.roomTypeName||"",u.required],active:[e.active||!1],roomTypeCategory:[e.roomTypeCategory||"Room",u.required],description:[e.description||"",u.required],adultOccupancy:[e.adultOccupancy||0,[u.min(1),u.required]],childOccupancy:[e.childOccupancy||0,u.required],totalrooms:[e.rooms?.length||0,[u.min(1),u.required]],rooms:this.fb.array([])});if(e.rooms){let o=t.get("rooms");for(let i of e.rooms)o.push(this.createRoom(i))}return t}addRoomType(e){this.roomTypes.push(this.createRoomType(e))}editRoomType(e,t){this.roomTypes.at(e).patchValue(t)}deleteRoomType(e){this.roomTypes.removeAt(e)}editRoom(e,t,o){let i=this.getRooms(e).at(t),_=i.value,f=i.value.roomId?T.UPDATE_ROOM+i.value.roomId:T.CREATE_ROOM;this.crudService.post(f,_).then(g=>{console.log(g),g.data.roomId=g.data._id,i.patchValue(g.data),i.disable(),this.alertService.successAlert(g.message)}).catch(g=>{this.alertService.errorAlert(g.message),console.log(g)})}deleteRoom(e,t){let o=this.getRooms(e),i=o.at(t).value.roomId;i?this.crudService.post(T.DELETE_ROOM+i).then(_=>{console.log(_),o.removeAt(t),this.alertService.successAlert(_.message)}).catch(_=>{this.alertService.errorAlert(_.message),console.log(_)}):o.removeAt(t)}trackByFn(e,t){return t.id||e}getRooms(e){return this.roomTypes.at(e).get("rooms")}toggleRow(e){this.expandedRowIndices.has(e)?this.expandedRowIndices.delete(e):this.expandedRowIndices.add(e)}isRowExpanded(e){return this.expandedRowIndices.has(e)}next(){this.router.navigate(["/baserate-setup/",this.propertyUnitId])}editPropertyUnit(){this.router.navigate(["/property-setup",this.propertyUnitId])}roomSort(e){for(let t of e)t.rooms.sort((o,i)=>o.roomType<i.roomType?-1:o.roomType>i.roomType?1:o.roomName<i.roomName?-1:o.roomName>i.roomName?1:0);return e}};c.\u0275fac=function(t){return new(t||c)(h(B),h(J),h(U),h(D),h(M))},c.\u0275cmp=w({type:c,selectors:[["app-rooms-review"]],standalone:!0,features:[A],decls:24,vars:4,consts:[[1,"container-fluid"],[1,"col-md-12","mt-4"],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary",3,"routerLink"],[1,"table",3,"formGroup"],[1,"col"],["formArrayName","roomTypes"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-primary","mb-3",3,"click"],["type","button",1,"btn","btn-primary","mb-3","ms-2",3,"click"],[3,"formGroupName"],[3,"routerLink"],[1,"link"],[1,"btn","btn-primary",3,"click"],[1,"material-symbols-rounded","ms-2",2,"vertical-align","middle","cursor","pointer",3,"click"],[4,"ngIf"],["colspan","4"],["class","table",4,"ngIf"],[1,"table"],["class","col",4,"ngIf"],["formArrayName","rooms"],["scope","row"],["type","text","formControlName","roomName",1,"text-center","w-100","border-0","form-control"],["class","text-danger",4,"ngIf"],["type","text","formControlName","roomNumber",1,"text-center","w-100","border-0","form-control"],[1,"text-danger"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"],["type","button","class","btn btn-primary me-2",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-primary","me-2",3,"click","disabled"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(t,o){t&1&&(m(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),l(4," Add Room Type "),r()()(),m(5,"table",4)(6,"thead")(7,"tr")(8,"th",5),l(9,"Room Type Name"),r(),m(10,"th",5),l(11,"Adult & Child"),r(),m(12,"th",5),l(13,"Status"),r(),m(14,"th",5),l(15," Action "),r()()(),m(16,"tbody",6),y(17,ae,17,9,"ng-container",7),r()(),m(18,"div",1)(19,"div",8)(20,"button",9),b("click",function(){return o.editPropertyUnit()}),l(21,"Back"),r(),m(22,"button",10),b("click",function(){return o.next()}),l(23,"Next"),r()()()()),t&2&&(s(3),d("routerLink","/roomtype-setup/"+o.propertyUnitId+"/ADD"),s(2),d("formGroup",o.roomTypesForm),s(12),d("ngForOf",o.roomTypes.controls)("ngForTrackBy",o.trackByFn))},dependencies:[V,F,O,K,G,$,L,Q,P,H,Y,z,j,q],styles:["table[_ngcontent-%COMP%]{text-align:center}"]});let n=c;return n})();export{be as RoomsReviewComponent};
