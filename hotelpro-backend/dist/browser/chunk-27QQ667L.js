import{c as U,d as u,e as $,f as L,m as P,n as Y,o as z,p as H,x as J,y as K,z as Q}from"./chunk-VIVXY5RX.js";import{Aa as N,Ba as R,Ca as b,Da as p,Db as M,Fb as D,Gb as q,Ib as j,Jb as C,L as w,Lb as B,Ma as c,Mb as G,Oa as I,Pa as k,R as v,S as x,Xa as A,ea as s,fa as h,la as g,na as d,ob as F,pb as O,qa as S,wa as a,wb as V,xa as i,ya as T,za as E}from"./chunk-CWTEAQ4G.js";function W(o,m){o&1&&(a(0,"th",5),c(1,"Action"),i())}function X(o,m){o&1&&(a(0,"small",25),c(1," Room Name is required "),i())}function Z(o,m){o&1&&(a(0,"small",25),c(1," Room Number is required "),i())}function ee(o,m){if(o&1){let r=R();a(0,"button",29),b("click",function(){v(r);let t=p(2).$implicit;return x(t.disabled?t.enable():t.disable())}),c(1," Edit "),i()}}function te(o,m){if(o&1){let r=R();a(0,"button",30),b("click",function(){v(r);let t=p(2),n=t.$implicit,l=t.index,_=p(3).index,f=p();return x(f.editRoom(_,l,n.value))}),c(1," Save "),i()}if(o&2){let r=p(2).$implicit;d("disabled",r.invalid)}}function oe(o,m){if(o&1){let r=R();a(0,"button",31),b("click",function(){v(r);let t=p(2).index,n=p(3).index,l=p();return x(l.deleteRoom(n,t))}),c(1," Delete "),i()}}function ie(o,m){if(o&1&&(a(0,"td")(1,"div"),g(2,ee,2,0,"button",26)(3,te,2,1,"button",27)(4,oe,2,0,"button",28),i()()),o&2){let r=p().$implicit;s(2),d("ngIf",r.disabled),s(),d("ngIf",!r.disabled),s(),d("ngIf",!r.disabled)}}function ne(o,m){if(o&1&&(a(0,"tr",10)(1,"th",21),c(2),i(),a(3,"td"),T(4,"input",22),g(5,X,2,0,"small",23),i(),a(6,"td"),T(7,"input",24),g(8,Z,2,0,"small",23),i(),g(9,ie,5,3,"td",15),i()),o&2){let r,e,t=m.$implicit,n=m.index,l=p(4);d("formGroupName",n),s(2),I(" ",n+1," "),s(3),d("ngIf",(((r=t.get("roomName"))==null?null:r.dirty)||((r=t.get("roomName"))==null?null:r.touched))&&((r=t.get("roomName"))==null?null:r.invalid)),s(3),d("ngIf",(((e=t.get("roomNumber"))==null?null:e.dirty)||((e=t.get("roomNumber"))==null?null:e.touched))&&((e=t.get("roomNumber"))==null?null:e.invalid)),s(),d("ngIf",l.showActionBtn)}}function re(o,m){if(o&1&&(a(0,"table",18)(1,"thead")(2,"tr")(3,"th",5),c(4,"Sr No."),i(),a(5,"th",5),c(6,"Room Name"),i(),a(7,"th",5),c(8,"Room Number"),i(),g(9,W,2,0,"th",19),i()(),a(10,"tbody",20),g(11,ne,10,5,"tr",7),i()()),o&2){let r=m.ngIf,e=p(3);s(9),d("ngIf",e.showActionBtn),s(2),d("ngForOf",r.controls)("ngForTrackBy",e.trackByFn)}}function ae(o,m){if(o&1&&(a(0,"tr")(1,"td",16),g(2,re,12,3,"table",17),i()()),o&2){let r=p().index,e=p();s(2),d("ngIf",e.getRooms(r))}}function le(o,m){if(o&1){let r=R();E(0,10),a(1,"tr")(2,"td")(3,"a",11),c(4),i()(),a(5,"td")(6,"div",12),c(7),i()(),a(8,"td")(9,"div",12),c(10),i()(),a(11,"td")(12,"button",13),b("click",function(){let t,n=v(r),l=n.$implicit,_=n.index,f=p();return x(f.addRoom(_,{roomTypeId:(t=l.get("roomTypeId"))==null?null:t.value}))}),c(13," Add Room "),i(),a(14,"i",14),b("click",function(){let t=v(r).index,n=p();return x(n.toggleRow(t))}),c(15," arrow_forward_ios "),i()()(),g(16,ae,3,1,"tr",15),N()}if(o&2){let r,e,t,n,l=m.$implicit,_=m.index,f=p();d("formGroupName",_),s(3),d("routerLink","/roomtype-setup/"+f.propertyUnitId+"/"+((r=l.get("roomTypeId"))==null?null:r.value)),s(),I(" ",(e=l.get("roomTypeName"))==null?null:e.value," "),s(3),k(" Adults- ",(t=l.get("adultOccupancy"))==null?null:t.value,",Childs-",(t=l.get("childOccupancy"))==null?null:t.value," "),s(3),I(" ",(n=l.get("active"))!=null&&n.value?"Active":"Deactive"," "),s(4),S(f.isRowExpanded(_)?"    rotate: 270deg;":"    rotate: 90deg;"),s(2),d("ngIf",f.isRowExpanded(_))}}var be=(()=>{let m=class m{constructor(e,t,n,l,_){this.crudService=e,this.fb=t,this.alertService=n,this.activeRoute=l,this.router=_,this.columnArray=[],this.showActionBtn=!0,this.filterData=[],this.searchbox="",this.propertyUnitId="",this.expandedRowIndices=new Set}ngOnInit(){this.propertyUnitId=this.activeRoute.snapshot.paramMap.get("propertyUnitId"),this.roomTypesForm=this.fb.group({roomTypes:this.fb.array([])}),this.loadRoomTypes()}loadRoomTypes(){this.crudService.post(C.READ_ROOMTYPE_AND_ROOMS+this.propertyUnitId).then(e=>{console.log(e);for(let t of e.data)this.addRoomType(t)}).catch(e=>{this.alertService.errorAlert(e?.error?.message),console.log(e)})}createRoom(e){let t=this.fb.group({roomName:[e?.roomName||"",[u.required]],roomNumber:[e?.roomNumber||"",[u.required,u.pattern("^[0-9]*$")]],roomId:[e?.roomId||""],roomTypeId:[e?.roomTypeId||"",u.required]});return e?.roomId&&t.disable(),t}addRoom(e,t){this.getRooms(e).push(this.createRoom(t))}get roomTypes(){return this.roomTypesForm.get("roomTypes")}createRoomType(e={}){let t=this.fb.group({roomTypeId:[e.roomTypeId||"",u.required],roomTypeName:[e.roomTypeName||"",u.required],active:[e.active||!1],roomTypeCategory:[e.roomTypeCategory||"Room",u.required],description:[e.description||"",u.required],adultOccupancy:[e.adultOccupancy||0,[u.min(1),u.required]],childOccupancy:[e.childOccupancy||0,u.required],totalrooms:[e.rooms?.length||0,[u.min(1),u.required]],rooms:this.fb.array([])});if(e.rooms){let n=t.get("rooms");for(let l of e.rooms)n.push(this.createRoom(l))}return t}addRoomType(e){this.roomTypes.push(this.createRoomType(e))}editRoomType(e,t){this.roomTypes.at(e).patchValue(t)}deleteRoomType(e){this.roomTypes.removeAt(e)}editRoom(e,t,n){let l=this.getRooms(e).at(t),_=l.value,f=l.value.roomId?C.UPDATE_ROOM+l.value.roomId:C.CREATE_ROOM;this.crudService.post(f,_).then(y=>{console.log(y),y.data.roomId=y.data._id,l.patchValue(y.data),l.disable(),this.alertService.successAlert(y.message)}).catch(y=>{this.alertService.errorAlert(y.message),console.log(y)})}deleteRoom(e,t){let n=this.getRooms(e),l=n.at(t).value.roomId;l?this.crudService.post(C.DELETE_ROOM+l).then(_=>{console.log(_),n.removeAt(t),this.alertService.successAlert(_.message)}).catch(_=>{this.alertService.errorAlert(_.message),console.log(_)}):n.removeAt(t)}trackByFn(e,t){return t.id||e}getRooms(e){return this.roomTypes.at(e).get("rooms")}toggleRow(e){this.expandedRowIndices.has(e)?this.expandedRowIndices.delete(e):this.expandedRowIndices.add(e)}isRowExpanded(e){return this.expandedRowIndices.has(e)}next(){this.router.navigate(["/baserate-setup/",this.propertyUnitId])}};m.\u0275fac=function(t){return new(t||m)(h(B),h(J),h(G),h(M),h(D))},m.\u0275cmp=w({type:m,selectors:[["app-rooms-review"]],standalone:!0,features:[A],decls:22,vars:4,consts:[[1,"container-fluid"],[1,"col-md-12","mt-4"],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary",3,"routerLink"],[1,"table",3,"formGroup"],[1,"col"],["formArrayName","roomTypes"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","justify-content-center"],[1,"btn","btn-primary","mb-3",3,"click"],[3,"formGroupName"],[3,"routerLink"],[1,"link"],[1,"btn","btn-primary",3,"click"],[1,"material-symbols-rounded","ms-2",2,"vertical-align","middle","cursor","pointer",3,"click"],[4,"ngIf"],["colspan","4"],["class","table",4,"ngIf"],[1,"table"],["class","col",4,"ngIf"],["formArrayName","rooms"],["scope","row"],["type","text","formControlName","roomName",1,"text-center","w-100","border-0","form-control"],["class","text-danger",4,"ngIf"],["type","text","formControlName","roomNumber",1,"text-center","w-100","border-0","form-control"],[1,"text-danger"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"],["type","button","class","btn btn-primary me-2",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-danger",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-primary","me-2",3,"click","disabled"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),c(4," Add RoomType "),i()()(),a(5,"table",4)(6,"thead")(7,"tr")(8,"th",5),c(9,"Room Type Name"),i(),a(10,"th",5),c(11,"Adult & Child"),i(),a(12,"th",5),c(13,"Status"),i(),a(14,"th",5),c(15," Action "),i()()(),a(16,"tbody",6),g(17,le,17,9,"ng-container",7),i()(),a(18,"div",1)(19,"div",8)(20,"button",9),b("click",function(){return n.next()}),c(21,"Next"),i()()()()),t&2&&(s(3),d("routerLink","/roomtype-setup/"+n.propertyUnitId+"/ADD"),s(2),d("formGroup",n.roomTypesForm),s(12),d("ngForOf",n.roomTypes.controls)("ngForTrackBy",n.trackByFn))},dependencies:[V,F,O,K,U,$,L,Q,P,H,Y,z,j,q],styles:["table[_ngcontent-%COMP%]{text-align:center}"]});let o=m;return o})();export{be as RoomsReviewComponent};
